Ext.ns("Sbi.settings");Sbi.settings.console={summaryPanel:{height:300},chartWidget:{height:130},widgetPanel:{columnNumber:3},gridPanel:{limit:15,loadMask:true}};Sbi.settings.console.masterDetailWindow={height:350};Sbi.settings.console.storeManager={limitSS:15,rowsLimit:50};Ext.override(Ext.grid.GridView,{init:function(a){this.grid=a;this.templates=this.templates||{};this.templates.hcell=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}"><div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id} x-grid3-hd-{cls}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{value}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div></td>");this.templates.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" {attr}>{value}</div>',"</td>");this.initTemplates();this.initData(a.store,a.colModel);this.initUI(a)},renderHeaders:function(){var c=this.cm,h=this.templates,e=h.hcell,b=[],l={},a=c.getColumnCount(),g=a-1;for(var d=0;d<a;d++){l.id=c.getColumnId(d);l.cls=c.getColumnById(l.id).cls||"";l.value=c.getColumnHeader(d)||"";l.style=this.getColumnStyle(d,true);l.tooltip=this.getColumnTooltip(d);l.css=d===0?"x-grid3-cell-first ":(d==g?"x-grid3-cell-last ":"");if(c.config[d].align=="right"){l.istyle="padding-right:16px"}else{delete l.istyle}b[b.length]=e.apply(l)}return h.header.apply({cells:b.join(""),tstyle:"width:"+this.getTotalWidth()+";"})}});Ext.override(Ext.PagingToolbar,{doRefresh:function(){if(this.store.lastParams){delete this.store.lastParams}this.doLoad(this.cursor)}});Ext.override(Ext.grid.ColumnModel,{isMenuDisabled:function(a){return !!this.config[a].menuDisabled}});Ext.override(Ext.grid.GridView,{handleHdOver:function(d,a){var c=this.findHeaderCell(a);if(c&&!this.headersDisabled){this.activeHd=c;this.activeHdIndex=this.getCellIndex(c);var b=this.fly(c);this.activeHdRegion=b.getRegion();if(!this.cm.isMenuDisabled(this.activeHdIndex)){b.addClass("x-grid3-hd-over");this.activeHdBtn=b.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(c.firstChild.offsetHeight-1)+"px"}}}}});Ext.override(Ext.tree.TreeLoader,{createNode:function(attr){if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs)}if(this.applyLoader!==false){attr.loader=this}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}var resultNode;if(attr.leaf){resultNode=new Ext.tree.TreeNode(attr);resultNode.attributes=attr.attributes}else{resultNode=new Ext.tree.AsyncTreeNode(attr)}return resultNode}});Ext.override(Ext.tree.TreePanel,{initComponent:function(){Ext.tree.TreePanel.superclass.initComponent.call(this);if(!this.eventModel){this.eventModel=new Ext.tree.TreeEventModel(this)}var a=this.loader;if(!a){a=new Ext.tree.TreeLoader({dataUrl:this.dataUrl})}else{if(typeof a=="object"&&!a.load){a=new Ext.tree.TreeLoader(a)}}this.loader=a;this.nodeHash={};if(this.root){var b=this.root;delete this.root;this.setRootNode(b)}this.addEvents("append","remove","movenode","insert","beforeappend","beforeremove","beforemovenode","beforeinsert","beforeload","load","textchange","beforeexpandnode","beforecollapsenode","expandnode","disabledchange","collapsenode","beforeclick","click","checkchange","dblclick","contextmenu","beforechildrenrendered","startdrag","enddrag","dragdrop","beforenodedrop","nodedrop","nodedragover");if(this.singleExpand){this.on("beforeexpandnode",this.restrictExpand,this)}},setRootNode:function(b,c){if(this.root){this.root.destroy()}if(!b.render){b=this.loader.createNode(b)}this.root=b;b.ownerTree=this;b.isRoot=true;this.registerNode(b);if(!this.rootVisible){var a=b.attributes.uiProvider;b.ui=a?new a(b):new Ext.tree.RootTreeNodeUI(b)}if(this.innerCt){this.innerCt.update("");this.afterRender()}return b}});Ext.ns("Sbi.exception.ExceptionHandler");Sbi.exception.ExceptionHandler=function(){return{init:function(){},onServiceRequestFailure:function(a,b){var e;if(a!==undefined){if(a.responseText!==undefined){var d=Ext.util.JSON.decode(a.responseText);if(d.errors!==undefined&&d.errors.length>0){for(var c=0;c<d.errors.length;c++){if(!d.errors[c].message){continue}if(!e){e=""}e+=d.errors[c].message+"<br>"}}if(d.message){e=e||d.message}}if(!e){e="An unspecified error occurred on the server side"}}else{e="Request has been aborted due to a timeout trigger"}e=e||"An error occurred while processing the server error response";if(e.indexOf("Warning")>=0){Sbi.Msg.showWarning(e,"Service Warning")}else{Sbi.Msg.showError(e,"Service Error")}},onStoreLoadException:function(d,e,g,c,b,a){var h="Generic error";if(e==="response"){h="An error occurred while parsing server response: "+a}else{if(e==="remote"){h="An error occurred at the server side"}}Sbi.Msg.showError(h,"Store loading error")}}}();Ext.ns("Sbi.service");Sbi.service.ServiceRegistry=function(a){a=a||{};this.baseUrl=Ext.apply({},a.baseUrl||{},{protocol:"http",host:"localhost",port:"8080",contextPath:"SpagoBI",controllerPath:"servlet/AdapterHTTP"});this.baseParams=Ext.apply({},a.baseParams||{},{SBI_EXECUTION_ID:-1});this.defaultAbsolute=a.defaultAbsolute!==undefined?a.defaultAbsolute:false;this.defaultServiceType=a.defaultServiceType!==undefined?a.defaultServiceType:"action";Sbi.service.ServiceRegistry.superclass.constructor.call(this)};Ext.extend(Sbi.service.ServiceRegistry,Ext.util.Observable,{baseUrl:null,baseParams:null,defaultAbsolute:null,defaultServiceType:null,setBaseUrl:function(a){Ext.apply(this.baseUrl,a)},getServiceUrl:function(a){var d;var g;var b;var e;if(typeof a=="string"){a={serviceName:a}}b=a.serviceType||this.defaultServiceType;e=Ext.apply({},a.baseParams||{},this.baseParams);d=this.getBaseUrlStr(a);d+="?";d+=(b==="action")?"ACTION_NAME":"PAGE";d+="=";d+=a.serviceName;for(var c in e){if(e[c]!==null){d+="&"+c+"="+e[c]}}return d},getBaseUrlStr:function(b){var d;if(this.baseUrl.completeUrl!==undefined){d=this.baseUrl.completeUrl}else{var c=b.isAbsolute||this.defaultAbsolute;var a=Ext.apply({},b.baseUrl||{},this.baseUrl);if(c){d=a.protocol+"://"+a.host+":"+a.port+"/"+a.contextPath+"/"+a.controllerPath}else{d="/"+a.contextPath+"/"+a.controllerPath}}return d}});Ext.ns("Sbi");Sbi.Sync=function(){var a="download-form";var c="post";var b;return{form:null,request:function(e){var d=this.getForm();if(e.method){d.method=e.method}d.action=e.url;if(d.method==="post"){this.resetForm();if(e.params){this.replaceDomHelper();for(p in e.params){this.addHiddenInput(p,e.params[p])}this.restoreDomHelper()}}else{if(e.params){d.action=Ext.urlAppend(d.action,Ext.urlEncode(e.params))}}d.submit()},resetForm:function(){var h=Ext.get(a);var g=h.query("input");for(var e=0,d=g.length;e<d;e++){var m=Ext.get(g[e]);m.remove()}},replaceDomHelper:function(){b=Ext.DomHelper.createHtml;Ext.DomHelper.createHtml=function(d){var m="",l,e,r,n,q;if(Ext.isString(d)){m=d}else{if(Ext.isArray(d)){for(var h=0;h<d.length;h++){if(d[h]){m+=createHtml(d[h])}}}else{m+="<"+(d.tag=d.tag||"div");Ext.iterate(d,function(o,s){if(!/tag|children|cn|html$/i.test(o)){if(Ext.isObject(s)){m+=" "+o+"='";Ext.iterate(s,function(u,t){m+=u+":"+t+";"});m+="'"}else{m+=" "+({cls:"class",htmlFor:"for"}[o]||o)+"='"+s+"'"}}});var g=/^(?:br|frame|hr|img|input|link|meta|range|spacer|wbr|area|param|col)$/i;if(g.test(d.tag)){m+="/>"}else{m+=">";if((q=d.children||d.cn)){m+=createHtml(q)}else{if(d.html){m+=d.html}}m+="</"+d.tag+">"}}}return m}},restoreDomHelper:function(){if(!b){alert("Impossible to restore createHtml in DomHelper object");return}Ext.DomHelper.createHtml=b},addHiddenInput:function(d,h){var g=Ext.get(a);var e=Ext.DomHelper;e.append(g,{tag:"input",type:"hidden",name:d,value:h})},getForm:function(){if(this.form===null){this.form=document.getElementById(a);if(!this.form){var d=Ext.DomHelper;this.form=d.append(Ext.getBody(),{id:a,tag:"form",method:c,cls:"download-form"})}}return this.form}}}();Ext.ns("Sbi.console.commons");Sbi.console.commons.Format=function(){return{date:function(a,b){b=b||"m/d/Y";if(typeof b==="string"){b={dateFormat:b,nullValue:""}}if(!a){return b.nullValue}if(!(a instanceof Date)){a=new Date(Date.parse(a))}a=a.dateFormat(b.dateFormat);return a},dateRenderer:function(a){return function(b){return Sbi.console.commons.Format.date(b,a)}},timestamp:function(a,b){b=b||"m/d/Y H:i:s";if(typeof b==="string"){b={timestampFormat:b,nullValue:""}}if(!a){return b.nullValue}if(!(a instanceof Date)){a=new Date(Date.parse(a))}a=a.dateFormat(b.dateFormat);return a},timestampRenderer:function(a){return function(b){return Sbi.console.commons.Format.timestamp(b,a)}},number:function(a,c){c=Ext.apply({},c||{},{decimalSeparator:".",decimalPrecision:2,groupingSeparator:",",groupingSize:3,currencySymbol:"",nullValue:""});if(a===undefined||a===null){return c.nullValue}if(typeof a!=="number"){a=String(a);if(c.currencySymbol){a=a.replace(c.currencySymbol,"")}if(c.groupingSeparator){a=a.replace(new RegExp(c.groupingSeparator,"g"),"")}if(c.decimalSeparator!=="."){a=a.replace(c.decimalSeparator,".")}a=parseFloat(a)}var d=a<0;a=Math.abs(a).toFixed(c.decimalPrecision);var b=a.indexOf(".");if(b>=0){if(c.decimalSeparator!=="."){a=a.slice(0,b)+c.decimalSeparator+a.slice(b+1)}}else{b=a.length}if(c.groupingSeparator){while(b>c.groupingSize){b-=c.groupingSize;a=a.slice(0,b)+c.groupingSeparator+a.slice(b)}}if(c.currencySymbol){a=c.currencySymbol+a}if(d){a="-"+a}return a},numberRenderer:function(a){return function(b){return Sbi.console.commons.Format.number(b,a)}},string:function(a,b){b=Ext.apply({},b||{},{trim:true,maxLength:null,ellipsis:true,changeCase:null,prefix:"",suffix:"",nullValue:""});if(!a){return b.nullValue}if(b.trim){a=Ext.util.Format.trim(a)}if(b.maxLength){if(b.ellipsis===true){a=Ext.util.Format.ellipsis(a,b.maxLength)}else{a=Ext.util.Format.substr(a,0,b.maxLength)}}if(b.changeCase){if(b.changeCase==="capitalize"){a=Ext.util.Format.capitalize(a)}else{if(b.changeCase==="uppercase"){a=Ext.util.Format.uppercase(a)}else{if(b.changeCase==="lowercase"){a=Ext.util.Format.lowercase(a)}}}}if(b.prefix){a=b.prefix+a}if(b.suffix){a=a+b.suffix}return a},stringRenderer:function(a){return function(b){return Sbi.console.commons.Format.string(b,a)}},"boolean":function(a,b){b=Ext.apply({},b||{},{trueSymbol:"true",falseSymbol:"false",nullValue:""});if(a===true){a=b.trueSymbol}else{if(a===true){a=b.falseSymbol}else{a=b.nullValue}}return a},booleanRenderer:function(a){return function(b){return Sbi.console.commons.Format["boolean"](b,a)}},html:function(a,b){a=Ext.util.Format.htmlDecode(a);return a},htmlRenderer:function(a){return function(b){return Sbi.console.commons.Format.html(b,a)}},inlineBarRenderer:function(a){return function(b){b=(b/a.totValue)*100;b=Sbi.console.commons.Format.number(b,{decimalPrecision:2});var c=(a.tooltip!==undefined)?a.tooltip:b;return'<div title="'+c+'" style="width:'+b+"%;height:10px;border:1px solid #000;background:"+a.color+';"/>'}},inlinePointRenderer:function(a){return function(t,c,n){var g=a.threshold;var d=(a.width===undefined)?"100%":a.width+"px";var r;var o;var u;var l;var q=false;if(a.thresholdType=="dataset"&&a.nameFieldThr!==undefined){g=n.get(a.nameFieldThr);q=true}if(t>g){r=a.tooltip;u="../img/ico_point_"+a.color+".gif";l=a.nameTooltipField}else{return""}o=r;if(q){if(l&&l!==undefined){for(var s in l){var h=l[s];var m=n.get(h.value);if(m){var b=r.replace("$F{"+h.name+"}",m);r=b}}o=r}}return'<div align=center title="'+o+'" style="width:'+d+'"><img src="'+u+'"></img></div>'}},inlineSemaphoreRenderer:function(a){return function(u,c,n){var t=a.thresholdFirstInt;var g=a.thresholdSecondInt;var d=(a.width===undefined)?"100%":a.width+"px";var r;var o;var w;var l;var q=false;if(a.thresholdType=="dataset"&&a.thresholdFirstInt!==undefined&&a.thresholdSecondInt!==undefined){t=n.get(a.nameFieldThrFirstInt);g=n.get(a.nameFieldThrSecondInt);q=true}if(u>g){r=a.tooltipRed||a.tooltip;w="../img/ico_point_red.gif";l=a.nameTooltipFieldRed}else{if(u<=g&&u>=t){r=a.tooltipYellow||a.tooltip;w="../img/ico_point_yellow.gif";l=a.nameTooltipFieldYellow}else{r=a.tooltipGreen||a.tooltip;w="../img/ico_point_green.gif";l=a.nameTooltipFieldGreen}}o=r;if(q){if(l&&l!==undefined){for(var s in l){var h=l[s];var m=n.get(h.value);if(m){var b=r.replace("$F{"+h.name+"}",m);r=b}}o=r}}return'<div align=center title="'+o+'" style="width:'+d+'"><img src="'+w+'"></img></div>'}}}}();Ext.ns("Sbi");Sbi.Msg=function(){return{showError:function(d,c){var a=d||"Generic error";var b=c||"Error";Ext.MessageBox.show({title:b,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR,modal:false})},showWarning:function(d,c){var a=d||"Generic warning";var b=c||"Warning";Ext.MessageBox.show({title:b,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING,modal:false})},showInfo:function(d,c){var a=d||"Generic info";var b=c||"Info";Ext.MessageBox.show({title:b,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,modal:false})},unimplementedFunction:function(b){var a=b?"Sorry, the functionality ["+b+"] has not been implemented yet":"Sorry, this functionality has not been implemented yet";Sbi.Msg.showInfo(a,"Unimplemented functionality")},deprectadeFunction:function(a,c){var b=c+" in class "+a+"is deprecated";Sbi.Msg.showWarning(b,"Deprecated functionality")}}}();Sbi.Assert=function(){return{assertTrue:function(b,a){if(!b){Sbi.Msg.showError(a)}},assertDefined:function(b,a){Sbi.Assert.assertTrue((b!==undefined&&b!==null),a)}}}();Ext.ns("Sbi.commons");Sbi.commons.JSON=new (function(){var useHasOwn={}.hasOwnProperty?true:false;var pad=function(n){return n<10?"0"+n:n};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var encodeString=function(s){if(/["\\\x00-\x1f]/.test(s)){return'"'+s.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c}c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+s+'"'};var encodeArray=function(o){var a=["["],b,i,l=o.length,v;for(i=0;i<l;i+=1){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(v===null?"null":Sbi.commons.JSON.encode(v));b=true}}a.push("]");return a.join("")};var encodeDate=function(o){o=encodeString(Ext.util.Format.date(o,"d/m/Y"));return o};this.encode=function(o){if(typeof o=="undefined"||o===null){return"null"}else{if(o instanceof Array){return encodeArray(o)}else{if(o instanceof Date){return encodeDate(o)}else{if(typeof o=="string"){return encodeString(o)}else{if(typeof o=="number"){return isFinite(o)?String(o):"null"}else{if(typeof o=="boolean"){return String(o)}else{var a=["{"],b,i,v;for(i in o){if(!useHasOwn||o.hasOwnProperty(i)){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(this.encode(i),":",v===null?"null":this.encode(v));b=true}}}a.push("}");return a.join("")}}}}}}};this.decode=function(json){return eval("("+json+")")}})();Ext.ns("Sbi.locale");Sbi.locale.dummyFormatter=function(a){return a};Sbi.locale.formatters={"int":Sbi.locale.dummyFormatter,"float":Sbi.locale.dummyFormatter,string:Sbi.locale.dummyFormatter,date:Sbi.locale.dummyFormatter,timestamp:Sbi.locale.dummyFormatter,"boolean":Sbi.locale.dummyFormatter,html:Sbi.locale.dummyFormatter,inlineBar:Sbi.locale.dummyFormatter,inlinePoint:Sbi.locale.dummyFormatter};if(Sbi.console.commons.Format){if(Sbi.locale.formats){Sbi.locale.formatters["int"]=Sbi.console.commons.Format.numberRenderer(Sbi.locale.formats["int"]);Sbi.locale.formatters["float"]=Sbi.console.commons.Format.numberRenderer(Sbi.locale.formats["float"]);Sbi.locale.formatters.string=Sbi.console.commons.Format.stringRenderer(Sbi.locale.formats.string);Sbi.locale.formatters.date=Sbi.console.commons.Format.dateRenderer(Sbi.locale.formats.date);Sbi.locale.formatters.timestamp=Sbi.console.commons.Format.dateRenderer(Sbi.locale.formats.timestamp);Sbi.locale.formatters["boolean"]=Sbi.console.commons.Format.booleanRenderer(Sbi.locale.formats["boolean"]);Sbi.locale.formatters.html=Sbi.console.commons.Format.htmlRenderer();Sbi.locale.formatters.inlineBar=Sbi.console.commons.Format.inlineBarRenderer();Sbi.locale.formatters.inlinePoint=Sbi.console.commons.Format.inlinePointRenderer()}else{Sbi.locale.formatters["int"]=Sbi.console.commons.Format.numberRenderer();Sbi.locale.formatters["float"]=Sbi.console.commons.Format.numberRenderer();Sbi.locale.formatters.string=Sbi.console.commons.Format.stringRenderer();Sbi.locale.formatters.date=Sbi.console.commons.Format.dateRenderer();Sbi.locale.formatters.timestamp=Sbi.console.commons.Format.timestampRenderer();Sbi.locale.formatters["boolean"]=Sbi.console.commons.Format.booleanRenderer();Sbi.locale.formatters.html=Sbi.console.commons.Format.htmlRenderer();Sbi.locale.formatters.inlineBar=Sbi.console.commons.Format.inlineBarRenderer();Sbi.locale.formatters.inlinePoint=Sbi.console.commons.Format.inlinePointRenderer()}}Sbi.locale.localize=function(a){if(!Sbi.locale.ln){return a}return Sbi.locale.ln[a]||a};Sbi.locale.getLNValue=function(d){var c=d;if(d!==undefined&&d.indexOf("LN(")>=0){var b=(d.indexOf(")"))-(d.indexOf("LN(")+3);var a=d.substr(d.indexOf("LN(")+3,b);c=LN(a)}return c};LN=Sbi.locale.localize;FORMATTERS=Sbi.locale.formatters;Ext.ns("Sbi.console");Sbi.console.StorePlugin=function(a){var b={filters:{}};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.storePlugin){b=Ext.apply(b,Sbi.settings.console.storePlugin)}var d=Ext.apply(b,a||{});Ext.apply(this,d);Sbi.console.StorePlugin.superclass.constructor.call(this,d);this.store.filterPlugin=this;this.store.addEvents("filterschange")};Ext.extend(Sbi.console.StorePlugin,Ext.util.Observable,{store:null,filters:null,removeFilter:function(a){delete this.filters[a]},addFilter:function(b,a){this.filters[b]=a},getFilter:function(a){return this.filters[a]},resetFilters:function(){filters={}},applyFilters:function(){if(this.store.getSortState()!==undefined){this.store.sort(this.store.getSortState().field,this.store.getSortState().direction)}this.store.filterBy(function(c,l){var b=false;var a=true;var d=true;for(var e in this.filters){var h=this.filters[e];for(var g in h){if(h[g]!==undefined){if(c.data[e]===h[g]){b=true}}}d=(b&&a);a=b;b=false}return d},this);this.fireEvent("filterschange",this.store,this.filters)},getFilters:function(a){return this.filters}});Ext.ns("Ext.ux.data");Ext.ux.data.PagingStore=Ext.extend(Ext.data.Store,{destroy:function(){if(this.storeId){Ext.StoreMgr.unregister(this)}this.data=this.allData=this.snapshot=null;Ext.destroy(this.proxy);this.reader=this.writer=null;this.purgeListeners()},add:function(b){b=[].concat(b);if(b.length<1){return}for(var d=0,a=b.length;d<a;d++){b[d].join(this)}var c=this.data.length;this.data.addAll(b);if(this.allData){this.allData.addAll(b)}if(this.snapshot){this.snapshot.addAll(b)}this.fireEvent("add",this,b,c)},remove:function(a){var b=this.data.indexOf(a);if(b>-1){this.data.removeAt(b)}if(this.allData){this.allData.remove(a)}if(this.snapshot){this.snapshot.remove(a)}if(this.pruneModifiedRecords){this.modified.remove(a)}if(b>-1){this.fireEvent("remove",this,a,b)}},removeAll:function(){this.data.clear();if(this.allData){this.allData.clear()}if(this.snapshot){this.snapshot.clear()}if(this.pruneModifiedRecords){this.modified=[]}this.fireEvent("clear",this)},insert:function(c,b){b=[].concat(b);for(var d=0,a=b.length;d<a;d++){this.data.insert(c,b[d]);b[d].join(this)}if(this.allData){this.allData.addAll(b)}if(this.snapshot){this.snapshot.addAll(b)}this.fireEvent("add",this,b,c)},getById:function(a){return(this.snapshot||this.allData||this.data).key(a)},execute:function(d,a,b){if(!Ext.data.Api.isAction(d)){throw new Ext.data.Api.Error("execute",d)}b=Ext.applyIf(b||{},{params:{}});var c=true;if(d==="read"){c=this.fireEvent("beforeload",this,b)}else{if(this.writer.listful===true&&this.restful!==true){a=(Ext.isArray(a))?a:[a]}else{if(Ext.isArray(a)&&a.length==1){a=a.shift()}}if((c=this.fireEvent("beforewrite",this,d,a,b))!==false){this.writer.write(d,b.params,a)}}if(c!==false){var e=Ext.apply({},b.params,this.baseParams);if(this.writer&&this.proxy.url&&!this.proxy.restful&&!Ext.data.Api.hasUniqueUrl(this.proxy,d)){e.xaction=d}if(d==="read"&&this.isPaging(e)){(function(){if(this.allData){this.data=this.allData;delete this.allData}this.applyPaging();this.fireEvent("datachanged",this);var g=[].concat(this.data.items);this.fireEvent("load",this,g,b);if(b.callback){b.callback.call(b.scope||this,g,b,true)}}).defer(1,this);return true}this.proxy.request(Ext.data.Api.actions[d],a,e,this.reader,this.createCallback(d,a),this,b)}return c},loadRecords:function(h,b,g){if(!h||g===false){if(g!==false){this.fireEvent("load",this,[],b)}if(b.callback){b.callback.call(b.scope||this,[],b,false,h)}return}var e=h.records,d=h.totalRecords||e.length;if(!b||b.add!==true){if(this.pruneModifiedRecords){this.modified=[]}for(var c=0,a=e.length;c<a;c++){e[c].join(this)}if(this.allData){this.data=this.allData;delete this.allData}if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(e);this.totalLength=d;this.applySort();if(!this.allData){this.applyPaging()}if(e.length!=this.getCount()){e=[].concat(this.data.items)}this.fireEvent("datachanged",this)}else{this.totalLength=Math.max(d,this.data.length+e.length);this.add(e)}this.fireEvent("load",this,e,b);if(b.callback){b.callback.call(b.scope||this,e,b,true)}},loadData:function(c,a){this.isPaging(Ext.apply({},this.lastOptions?this.lastOptions.params:null,this.baseParams));var b=this.reader.readRecords(c);this.loadRecords(b,{add:a},true)},getTotalCount:function(){return this.allData?this.allData.getCount():this.totalLength||0},sortData:function(c,d){d=d||"ASC";var a=this.fields.get(c).sortType;var b=function(g,e){var l=a(g.data[c]),h=a(e.data[c]);return l>h?1:(l<h?-1:0)};if(this.allData){this.data=this.allData;delete this.allData}this.data.sort(d,b);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(d,b)}this.applyPaging()},filterBy:function(b,a){this.snapshot=this.snapshot||this.allData||this.data;delete this.allData;this.data=this.queryBy(b,a||this);this.applyPaging();this.fireEvent("datachanged",this)},queryBy:function(b,a){var c=this.snapshot||this.allData||this.data;return c.filterBy(b,a||this)},collect:function(m,n,b){var h=(b===true?this.snapshot||this.allData||this.data:this.data).items;var o,q,a=[],c={};for(var e=0,g=h.length;e<g;e++){o=h[e].data[m];q=String(o);if((n||!Ext.isEmpty(o))&&!c[q]){c[q]=true;a[a.length]=o}}return a},clearFilter:function(a){if(this.isFiltered()){this.data=this.snapshot;delete this.allData;delete this.snapshot;this.applyPaging();if(a!==true){this.fireEvent("datachanged",this)}}},isFiltered:function(){return this.snapshot&&this.snapshot!=(this.allData||this.data)},isPaging:function(e){var b=this.paramNames,g=e[b.start],a=e[b.limit];if((typeof g!="number")||(typeof a!="number")){delete this.start;delete this.limit;this.lastParams=e;return false}this.start=g;this.limit=a;delete e[b.start];delete e[b.limit];var c=this.lastParams;this.lastParams=e;if(!this.proxy){return true}if(!c){return false}for(var d in e){if(e.hasOwnProperty(d)&&(e[d]!==c[d])){return false}}for(d in c){if(c.hasOwnProperty(d)&&(e[d]!==c[d])){return false}}return true},applyPaging:function(){var l=this.start,b=this.limit;if((typeof l=="number")&&(typeof b=="number")){var e=this.data,g=new Ext.util.MixedCollection(e.allowFunctions,e.getKey);g.items=e.items.slice(l,l+b);g.keys=e.keys.slice(l,l+b);var a=g.length=g.items.length;var h={};for(var c=0;c<a;c++){var d=g.items[c];h[g.getKey(d)]=d}g.map=h;this.allData=e;this.data=g}}});Ext.ux.data.PagingDirectStore=function(a){a.batchTransactions=false;Ext.ux.data.PagingDirectStore.superclass.constructor.call(this,Ext.apply(a,{proxy:(typeof(a.proxy)=="undefined")?new Ext.data.DirectProxy(Ext.copyTo({},a,"paramOrder,paramsAsHash,directFn,api")):a.proxy,reader:(typeof(a.reader)=="undefined"&&typeof(a.fields)=="object")?new Ext.data.JsonReader(Ext.copyTo({},a,"totalProperty,root,idProperty"),a.fields):a.reader}))};Ext.extend(Ext.ux.data.PagingDirectStore,Ext.ux.data.PagingStore,{});Ext.reg("pagingdirectstore",Ext.ux.data.PagingDirectStore);Ext.ux.data.PagingJsonStore=Ext.extend(Ext.ux.data.PagingStore,{constructor:function(a){Ext.ux.data.PagingJsonStore.superclass.constructor.call(this,Ext.apply(a,{reader:new Ext.data.JsonReader(a)}))}});Ext.reg("pagingjsonstore",Ext.ux.data.PagingJsonStore);Ext.ux.data.PagingXmlStore=Ext.extend(Ext.ux.data.PagingStore,{constructor:function(a){Ext.ux.data.PagingXmlStore.superclass.constructor.call(this,Ext.apply(a,{reader:new Ext.data.XmlReader(a)}))}});Ext.reg("pagingxmlstore",Ext.ux.data.PagingXmlStore);Ext.ux.data.PagingArrayStore=Ext.extend(Ext.ux.data.PagingStore,{constructor:function(a){Ext.ux.data.PagingArrayStore.superclass.constructor.call(this,Ext.apply(a,{reader:new Ext.data.ArrayReader(a)}))},loadData:function(e,b){if(this.expandData===true){var d=[];for(var c=0,a=e.length;c<a;c++){d[d.length]=[e[c]]}e=d}Ext.ux.data.PagingArrayStore.superclass.loadData.call(this,e,b)}});Ext.reg("pagingarraystore",Ext.ux.data.PagingArrayStore);Ext.ux.data.PagingSimpleStore=Ext.ux.data.PagingArrayStore;Ext.reg("pagingsimplestore",Ext.ux.data.PagingSimpleStore);Ext.ns("Sbi.data");Sbi.data.MemoryStore=function(a){this.alias2NameMap={};this.dsLabel=a.datasetLabel;if(!a.url){var b;if(a.serviceName){b={serviceName:a.serviceName};if(a.baseParams){b.baseParams=a.baseParams;delete a.baseParams}delete a.serviceName;a.url=Sbi.config.serviceRegistry.getServiceUrl(b)}else{if(a.datasetLabel){b={serviceName:"GET_CONSOLE_DATA_ACTION"};a.baseParams=a.baseParams||{};a.baseParams.ds_label=a.datasetLabel;a.baseParams.ds_rowsLimit=a.rowsLimit||-1;a.baseParams.ds_memoryPagination=a.memoryPagination;this.dsLabel=a.baseParams.ds_label;b.baseParams=a.baseParams;delete a.datasetLabel;delete a.baseParams;a.url=Sbi.config.serviceRegistry.getServiceUrl(b)}}}this.refreshTime=a.refreshTime;delete a.refreshTime;Sbi.data.MemoryStore.superclass.constructor.call(this,a)};Ext.extend(Sbi.data.MemoryStore,Ext.ux.data.PagingJsonStore,{alias2FieldMetaMap:null,refreshTime:null,dsLabel:null,getFieldMetaByAlias:function(b){if(!this.alias2FieldMetaMap){Sbi.Msg.showError("Impossible to [getFieldMetaByAlias of "+b+" ]. Store "+this.dsLabel+" has not loaded yet.","Wrong function call")}var a=this.alias2FieldMetaMap[b];if(a){if(a.length===0){a=undefined}else{if(a.length===1){a=a[0]}else{a=a[0];alert("Warning: there are ["+a.length+"] fields whose alias is ["+b+"]. Only the first one will be used")}}}return a},getFieldNameByAlias:function(b){var c;var a=this.getFieldMetaByAlias(b);if(a){c=a.name}return c},loadStore:function(){this.load({params:{},callback:function(){this.ready=true},scope:this,add:false})},getDsLabel:function(){return this.dsLabel},onMetaChange:function(e){this.alias2FieldMetaMap={};var a=e.fields;for(var c=0,b=a.length,d;c<b;c++){d=a[c];if(typeof d==="string"){d={name:d}}d.header=d.header||d.name;if(!this.alias2FieldMetaMap[d.header]){this.alias2FieldMetaMap[d.header]=new Array()}this.alias2FieldMetaMap[d.header].push(d)}Sbi.data.MemoryStore.superclass.onMetaChange.call(this,e)}});Ext.ns("Sbi.data");Sbi.data.Store=function(a){this.alias2NameMap={};this.dsLabel=a.datasetLabel;if(!a.url){var b;if(a.serviceName){b={serviceName:a.serviceName};if(a.baseParams){b.baseParams=a.baseParams;delete a.baseParams}delete a.serviceName;a.url=Sbi.config.serviceRegistry.getServiceUrl(b)}else{if(a.datasetLabel){b={serviceName:"GET_CONSOLE_DATA_ACTION"};a.baseParams=a.baseParams||{};a.baseParams.ds_label=a.datasetLabel;a.baseParams.ds_limitSS=a.limitSS||-1;a.baseParams.rowsLimit=a.rowsLimit||-1;a.baseParams.ds_memoryPagination=a.memoryPagination;this.dsLabel=a.baseParams.ds_label;b.baseParams=a.baseParams;delete a.datasetLabel;delete a.baseParams;a.url=Sbi.config.serviceRegistry.getServiceUrl(b)}}}this.refreshTime=a.refreshTime;delete a.refreshTime;Sbi.data.Store.superclass.constructor.call(this,a)};Ext.extend(Sbi.data.Store,Ext.data.JsonStore,{alias2FieldMetaMap:null,refreshTime:null,dsLabel:null,getFieldMetaByAlias:function(b){if(!this.alias2FieldMetaMap){Sbi.Msg.showError("Impossible to [getFieldMetaByAlias]. Store has not loaded yet.","Wrong function call")}var a=this.alias2FieldMetaMap[b];if(a){if(a.length===0){a=undefined}else{if(a.length===1){a=a[0]}else{a=a[0];alert("Warning: there are ["+a.length+"] fields whose alias is ["+b+"]. Only the first one will be used")}}}return a},getFieldNameByAlias:function(b){var c;var a=this.getFieldMetaByAlias(b);if(a){c=a.name}return c},loadStore:function(){this.load({params:{},callback:function(){this.ready=true},scope:this,add:false})},getDsLabel:function(){return this.dsLabel},onMetaChange:function(e){this.alias2FieldMetaMap={};var a=e.fields;for(var c=0,b=a.length,d;c<b;c++){d=a[c];if(typeof d==="string"){d={name:d}}d.header=d.header||d.name;if(!this.alias2FieldMetaMap[d.header]){this.alias2FieldMetaMap[d.header]=new Array()}this.alias2FieldMetaMap[d.header].push(d)}Sbi.data.Store.superclass.onMetaChange.call(this,e)}});Ext.ns("Sbi.console");Sbi.console.StoreManager=function(a){var b={};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.storeManager){b=Ext.apply(b,Sbi.settings.console.storeManager)}var d=Ext.apply(b,a||{});Ext.apply(this,d);this.init(d.datasetsConfig);Sbi.console.StoreManager.superclass.constructor.call(this,d)};Ext.extend(Sbi.console.StoreManager,Ext.util.Observable,{stores:null,addStore:function(b){if(b.dsLabel!==undefined){b.ready=b.ready||false;b.storeType=b.storeType||"ext";b.filterPlugin=new Sbi.console.StorePlugin({store:b});this.stores.add(b);if(b.refreshTime){var a={run:function(){if(b.stopped){return}if(b.lastParams){delete b.lastParams}b.load({params:b.pagingParams||{},callback:function(){this.ready=true},scope:b,add:false})},interval:b.refreshTime*1000};Ext.TaskMgr.start(a)}}},getStore:function(a){return this.stores.get(a)},stopRefresh:function(e,b){if(b){var d=this.stores.get(b);d.stopped=e}else{for(var c=0,a=this.stores.length,d;c<a;c++){var d=this.stores.get(c);if(d.dsLabel!==undefined){d.stopped=e}}}},forceRefresh:function(){for(var b=0,a=this.stores.length;b<a;b++){var c=this.getStore(b);if(c!==undefined&&c.dsLabel!==undefined&&c.dsLabel!=="testStore"&&!c.stopped){c.load({params:c.pagingParams||{},callback:function(){this.ready=true},scope:c,add:false})}}},init:function(g){g=g||[];this.stores=new Ext.util.MixedCollection();this.stores.getKey=function(c){return c.storeId};for(var d=0,a=g.length,e;d<a;d++){if(g[d].memoryPagination!==undefined&&g[d].memoryPagination===false){e=new Sbi.data.Store({storeId:g[d].id,datasetLabel:g[d].label,autoLoad:false,refreshTime:g[d].refreshTime,limitSS:this.limitSS,memoryPagination:g[d].memoryPagination||false})}else{e=new Sbi.data.MemoryStore({storeId:g[d].id,datasetLabel:g[d].label,autoLoad:false,refreshTime:g[d].refreshTime,rowsLimit:g[d].rowsLimit||this.rowsLimit,memoryPagination:g[d].memoryPagination||true})}e.ready=g[d].ready||false;e.storeType="sbi";e.stopped=true;this.addStore(e)}var b=new Ext.data.JsonStore({id:"testStore",fields:["name","visits","views"],data:[{name:"Jul 07",visits:245000,views:3000000},{name:"Aug 07",visits:240000,views:3500000},{name:"Sep 07",visits:355000,views:4000000},{name:"Oct 07",visits:375000,views:4200000},{name:"Nov 07",visits:490000,views:4500000},{name:"Dec 07",visits:495000,views:5800000},{name:"Jan 08",visits:520000,views:6000000},{name:"Feb 08",visits:620000,views:7500000}]});b.ready=true;b.storeType="ext";this.addStore(b)}});Ext.ns("Sbi.chart");Sbi.chart.FusionFreeChart=function(a){Sbi.chart.FusionFreeChart.superclass.constructor.call(this,a)};Ext.extend(Sbi.chart.FusionFreeChart,Ext.FlashComponent,{initComponent:function(){Sbi.chart.FusionFreeChart.superclass.initComponent.call(this);if(!this.url){this.url=Sbi.chart.FusionFreeChart.CHART_URL}this.autoScroll=true;this.flashVars={scaleMode:"exactfit"}},onRender:function(b,a){this.flashVars.chartWidth=b.getWidth();this.flashVars.chartHeight=b.getHeight();this.flashVars.dataXML=this.encodeDataXML("<graph caption='Fusion Free Chart' xAxisName='Month' yAxisName='Units' showNames='1' decimalPrecision='0' formatNumberScale='0'><set name='Jan' value='462' color='AFD8F8' /><set name='Feb' value='857' color='F6BD0F' /><set name='Mar' value='671' color='8BBA00' /><set name='Apr' value='494' color='FF8E46'/><set name='May' value='761' color='008E8E'/><set name='Jun' value='960' color='D64646'/><set name='Jul' value='629' color='8E468E'/><set name='Aug' value='622' color='588526'/><set name='Sep' value='376' color='B3AA00'/><set name='Oct' value='494' color='008ED6'/><set name='Nov' value='761' color='9D080D'/><set name='Dec' value='960' color='A186BE'/></graph>");Sbi.chart.FusionFreeChart.superclass.onRender.call(this,b,a)},encodeDataXML:function(d){var h=["\\$","\\+"];var c=d.match(/=\s*\".*?\"/g);if(c){for(var e=0;e<c.length;e++){var l=c[e].replace(/^=\s*\"|\"$/g,"");l=l.replace(/\'/g,"%26apos;");var g=d.indexOf(c[e]);var a="='"+l+"'";var b=d.substring(0,g);var m=d.substring(g+c[e].length);var d=b+a+m}}d=d.replace(/\"/g,"%26quot;");d=d.replace(/%(?![\da-f]{2}|[\da-f]{4})/ig,"%25");d=d.replace(/\&/g,"%26");return d},testFn:function(){this.swf.setDataXML("<graph caption='Monthly Unit Sales' xAxisName='Month' yAxisName='Units' showNames='1' decimalPrecision='0' formatNumberScale='0'><set name='Jan' value='462' color='AFD8F8' /><set name='Feb' value='857' color='F6BD0F' /><set name='Mar' value='671' color='8BBA00' /><set name='Apr' value='494' color='FF8E46'/><set name='May' value='761' color='008E8E'/><set name='Jun' value='960' color='D64646'/><set name='Jul' value='629' color='8E468E'/><set name='Aug' value='622' color='588526'/><set name='Sep' value='376' color='B3AA00'/><set name='Oct' value='494' color='008ED6'/><set name='Nov' value='761' color='9D080D'/><set name='Dec' value='960' color='A186BE'/></graph>")}});Sbi.chart.FusionFreeChart.CHART_URL="/SpagoBIConsoleEngine/swf/fusionchartfree/FCF_Column3D.swf";Ext.ns("Sbi.chart");Sbi.chart.OpenFlashChart=function(a){Sbi.chart.OpenFlashChart.superclass.constructor.call(this,a)};Ext.extend(Sbi.chart.OpenFlashChart,Ext.FlashComponent,{initComponent:function(){Sbi.chart.OpenFlashChart.superclass.initComponent.call(this);if(!this.url){this.url=Sbi.chart.OpenFlashChart.CHART_URL}this.autoScroll=true;this.flashVars={paramWidth:100,paramHeight:100,minValue:-100,maxValue:100,lowValue:-50,highValue:50}},onRender:function(b,a){this.flashVars.paramWidth=b.getWidth();this.flashVars.paramHeight=b.getHeight();Sbi.chart.OpenFlashChart.superclass.onRender.call(this,b,a)},testFn:function(){this.swf.load()}});function open_flash_chart_data(){var a=Ext.util.JSON.encode({elements:[{type:"bar_sketch",colour:"#81AC00","outline-colour":"#567300",offset:5,values:[{top:3,tip:"Hello #val#"},1,2,3,{top:3,tip:"Hello #val#"},{top:3,tip:"Hello #val#"},{top:3,tip:"Hello #val#"},{top:3,tip:"Hello #val#"},{top:3,tip:"Hello #val#"},{top:3,tip:"Hello #val#"},10,11]}],title:{text:"Open Flash Chart",style:"{color: #567300; font-size: 14px}"},bg_colour:"#FFFFFF"});return a}Sbi.chart.OpenFlashChart.CHART_URL="/SpagoBIConsoleEngine/swf/openflashchart/open-flash-chart.swf";Ext.ns("Sbi.chart");Sbi.chart.SpagoBIChart=function(a){this.bindStoreBeforeSwfInit=a.bindStoreBeforeSwfInit||false;this.bindStore(a.store,true);if(a.bindStoreBeforeSwfInit){delete a.bindStoreBeforeSwfInit}if(a.store){delete a.store}var b=Ext.apply({},a);if(b.storeManager){this.storeManager=b.storeManager;delete b.storeManager}if(b.ownerCt){delete b.ownerCt}for(p in b){if((typeof b[p])==="object"){b[p]=Ext.util.JSON.encode(b[p]);b[p]=b[p].replace(new RegExp('"',"g"),"|")}}this.flashVars=Ext.applyIf(b,this.CHART_DEFAULT_CONFIG);this.flashVars.scale="exactfit";this.flashParams=this.flashParams||{};this.flashParams.scale="exactfit";this.flashVars.isIE=Ext.isIE;Sbi.chart.SpagoBIChart.superclass.constructor.call(this,a)};Ext.extend(Sbi.chart.SpagoBIChart,Ext.FlashComponent,{store:null,storeMeta:null,bindStoreBeforeSwfInit:null,url:null,isLastWidget:null,disableCaching:false,disableCacheParam:"_dc",initComponent:function(){Sbi.chart.SpagoBIChart.superclass.initComponent.call(this);if(!this.url){this.url=Sbi.chart.SpagoBIChart.CHART_BASE_URL+this.CHART_SWF}if(this.disableCaching){this.url=Ext.urlAppend(this.url,String.format("{0}={1}",this.disableCacheParam,new Date().getTime()))}this.addEvents("beforerefresh","refresh");this.autoScroll=true},isSwfReady:function(){return true},onSwfReady:function(a){Ext.chart.Chart.superclass.onSwfReady.call(this,a);alert("onSwfReady");if(!a&&!this.bindStoreBeforeSwfInit){alert("Bind store");this.bindStore(this.store,true)}this.refresh.defer(10,this)},refresh:function(){if(!this.isSwfReady()){if(this.bindStoreBeforeSwfInit){this.onPendingRefresh()}return}if(this.fireEvent("beforerefresh",this)!==false){this.onRefresh();this.fireEvent("refresh",this)}},onRefresh:Ext.emptyFn,onPendingRefresh:function(){alert("Chart is unable to handle incoming data before inizialization")},bindStore:function(a,b){if(!b&&this.store){this.unbindStore(a!==this.store&&this.store.autoDestroy)}if(a){a.on("datachanged",this.refresh,this);a.on("add",this.refresh,this);a.on("remove",this.refresh,this);a.on("update",this.refresh,this);a.on("clear",this.refresh,this);a.on("metachange",this.onStoreMetaChange,this)}this.store=a;if(a&&!b){this.refresh()}},unbindStore:function(a){a=a||false;if(a){this.store.destroy()}else{this.store.un("datachanged",this.refresh,this);this.store.un("add",this.refresh,this);this.store.un("remove",this.refresh,this);this.store.un("update",this.refresh,this);this.store.un("clear",this.refresh,this);this.store.un("metachange",this.onStoreMetaChange,this)}},onStoreMetaChange:function(b,a){this.storeMeta=a}});Sbi.chart.SpagoBIChart.CHART_BASE_URL="/SpagoBIConsoleEngine/swf/spagobichart/";Sbi.chart.Multileds=Ext.extend(Sbi.chart.SpagoBIChart,{CHART_SWF:"multileds.swf",CHART_DEFAULT_CONFIG:{fields:Ext.util.JSON.encode([{header:"EffortIdx",name:"EffortIndex",descValue:"descEffortIndex",rangeMaxValue:100,secondIntervalUb:66,firstIntervalUb:10,rangeMinValue:0},{header:"Compet.",name:"Competitiveness",descValue:"descCompetitiveness",rangeMaxValue:100,secondIntervalUb:66,firstIntervalUb:33,rangeMinValue:0},{header:"CostOpt.",name:"CostOptimization",descValue:"descCostOptimization",rangeMaxValue:100,secondIntervalUb:66,firstIntervalUb:33,rangeMinValue:0},{header:"Health",name:"Health",descValue:"descHealth",rangeMaxValue:100,secondIntervalUb:66,firstIntervalUb:33,rangeMinValue:0}])},isSwfReady:function(){return !!this.swf.loadData},onRefresh:function(){var h={};var m=this.store.getAt(0);if(m){var b=this.storeMeta.fields;for(var e=0,c=b.length,g;e<c;e++){g=b[e];if((typeof g)==="string"){g={name:g}}var d=g.header||g.name;if(d==="recNo"){continue}var a=this.getDescriptionColumn(d);if(a!==undefined&&a!=""){h[d]=m.get(g.name)+"|"+m.get(this.store.getFieldNameByAlias(a))}else{h[d]=m.get(g.name)}}this.swf.loadData(h)}},getDescriptionColumn:function(b){if(this.fields===undefined){return""}var c="";for(var a=0;a<this.fields.length;a++){if(b===this.fields[a].name){c=this.fields[a].descValue;break}}return c}});Ext.reg("chart.sbi.multileds",Sbi.chart.Multileds);Sbi.chart.Livelines=Ext.extend(Sbi.chart.SpagoBIChart,{CHART_SWF:"livelines.swf",CHART_DEFAULT_CONFIG:{rangeMinValue:0,rangeMaxValue:120,stepY:40,domainValueNumber:18,title:"SpagoBI Liveline"},isSwfReady:function(){return !!this.swf.loadData},onRefresh:function(){var g={};var h=this.store.getAt(0);if(h){var a=this.storeMeta.fields;for(var d=0,b=a.length,e;d<b;d++){e=a[d];if((typeof e)==="string"){e={name:e}}var c=e.header||e.name;if(c==="recNo"||!this.isVisible(c)){continue}g[c]=h.get(e.name)}this.swf.loadData(g)}},isVisible:function(c){if(this.fields===undefined){return true}var a=false;for(var b=0;b<this.fields.length;b++){if(c===this.fields[b]){a=true;break}}if(this.includeFields!==undefined&&this.includeFields===false){a=!a}return a}});Ext.reg("chart.sbi.livelines",Sbi.chart.Livelines);Sbi.chart.Speedometer=Ext.extend(Sbi.chart.SpagoBIChart,{CHART_SWF:"speedometer.swf",CHART_DEFAULT_CONFIG:{minValue:0,maxValue:100,lowValue:33,highValue:66,field:"EffortIndex"},isSwfReady:function(){return !!this.swf.setValue},onRender:function(b,a){Sbi.chart.SpagoBIChart.superclass.onRender.call(this,b,a)},onRefresh:function(){var c;var d=this.store.getAt(0);if(d){var b=this.store.getFieldNameByAlias(this.flashVars.field);var a=this.flashVars.descValue;if(a!==undefined&&a!=""){c=d.get(b)+"|"+d.get(this.store.getFieldNameByAlias(a))}else{c=d.get(b)}}this.swf.setValue(c)}});Ext.reg("chart.sbi.speedometer",Sbi.chart.Speedometer);Sbi.chart.Semaphore=Ext.extend(Sbi.chart.SpagoBIChart,{CHART_SWF:"semaphore.swf",CHART_DEFAULT_CONFIG:{header:"Effort",field:"EffortIndex",orientation:"vertical",rangeMaxValue:100,rangeSecondInterval:66,rangeFirstInterval:10,rangeMinValue:0},isSwfReady:function(){return !!this.swf.setValue},onRender:function(b,a){Sbi.chart.SpagoBIChart.superclass.onRender.call(this,b,a)},onRefresh:function(){var c;var d=this.store.getAt(0);if(d){var b=this.store.getFieldNameByAlias(this.flashVars.field);var a=this.flashVars.descValue;if(a!==undefined&&a!=""){c=d.get(b)+"|"+d.get(this.store.getFieldNameByAlias(a))}else{c=d.get(b)}}this.swf.setValue(c)}});Ext.reg("chart.sbi.semaphore",Sbi.chart.Semaphore);Ext.ns("Sbi.console");Sbi.console.Widget=function(b){var d={defaultMsg:" "};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.widget){d=Ext.apply(d,Sbi.settings.console.widget)}var e=Ext.apply(d,b||{});Ext.apply(this,e);this.msgPanel=new Ext.Panel({html:this.defaultMsg});if(this.linkableDoc!==undefined){var a=[];a.push({text:this.linkableDoc.text,tooltip:(this.linkableDoc.tooltip===undefined)?"":this.linkableDoc.tooltip,styles:{font:{style:"bold"}},documentConf:this.linkableDoc,executionContext:this.executionContext,handler:this.execCrossNavigation,scope:this});this.toolLink=new Ext.Toolbar({autoWidth:true,items:a});delete this.linkableDoc}if(this.toolLink!==undefined){e=Ext.apply(e,{header:false,tbar:this.toolLink,items:[this.msgPanel]})}else{e=Ext.apply(e,{items:[this.msgPanel]})}Sbi.console.Widget.superclass.constructor.call(this,e)};Ext.extend(Sbi.console.Widget,Ext.Panel,{services:null,parentContainer:null,setParentContainer:function(a){this.parentContainer=a},getStore:function(b){var a;if(this.parentContainer){var c=this.parentContainer.getStoreManager();if(c){a=c.getStore(b)}else{alert("getStore: storeManager not defined")}}else{alert("getStore: container not defined")}return a},onRender:function(b,a){Sbi.console.Widget.superclass.onRender.call(this,b,a)},execCrossNavigation:function(a){if(sendMessage===undefined){Sbi.Msg.showError("function [sendMessage] is not defined","Cross navigation error");return}if((typeof sendMessage)!=="function"){Sbi.Msg.showError("[sendMessage] is not a function","Cross navigation error");return}var n={label:a.documentConf.label,windowName:this.name};var h="";if(a.documentConf.staticParams){n.parameters="";for(p in a.documentConf.staticParams){n.parameters+=h+p+"="+a.documentConf.staticParams[p];h="&"}}if(a.documentConf.dynamicParams){if(n.parameters===undefined){n.parameters=""}var d="";for(var g=0,c=a.documentConf.dynamicParams.length;g<c;g++){var m=a.documentConf.dynamicParams[g];for(p in m){var e=m[p];if(p!="scope"){if(m.scope==="env"){if(a.executionContext[e]===undefined){d+='Parameter "'+p+'" undefined into request. <p>'}else{n.parameters+=h+p+"="+a.executionContext[e];h="&"}}}}}}sendMessage(n,"crossnavigation")}});Ext.ns("Sbi.console");Sbi.console.WidgetContainer=function(a){var b={};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.widgetContainer){b=Ext.apply(b,Sbi.settings.console.widgetContainer)}var d=Ext.apply(b,a||{});Ext.apply(this,d);this.init();Sbi.console.WidgetContainer.superclass.constructor.call(this,d)};Ext.extend(Sbi.console.WidgetContainer,Ext.util.Observable,{widgets:null,env:null,storeManager:null,register:function(a){this.widgets.addAll(a)},unregister:function(a){this.remove(a)},lookup:function(a){this.widgets.get(a)},getWidgets:function(){return this.widgets},getStoreManager:function(){return this.storeManager},init:function(){if(!this.storeManager){alert("Store manager not defined");this.storeManager=new Ext.util.MixedCollection();var a=new Ext.data.JsonStore({fields:["name","visits","views"],data:[{name:"Jul 07",visits:245000,views:3000000},{name:"Aug 07",visits:240000,views:3500000},{name:"Sep 07",visits:355000,views:4000000},{name:"Oct 07",visits:375000,views:4200000},{name:"Nov 07",visits:490000,views:4500000},{name:"Dec 07",visits:495000,views:5800000},{name:"Jan 08",visits:520000,views:6000000},{name:"Feb 08",visits:620000,views:7500000}]});this.storeManager.add("testStore",a)}this.widgets=new Ext.util.MixedCollection();this.widgets.on("add",this.onWidgetAdd,this);this.widgets.on("remove",this.onWidgetRemove,this)},onWidgetAdd:function(a,c,b){c.setParentContainer(this)},onWidgetRemove:function(b,a){b.setParentContainer(null)}});Ext.ns("Sbi.console");Sbi.console.WidgetPanel=function(b){var d={layout:"table",layoutConfig:{tableAttrs:{style:{width:"100%",height:"100%"}}}};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.widgetPanel){d=Ext.apply(d,Sbi.settings.console.widgetPanel)}var e=Ext.apply(d,b||{});if(e.layout!==undefined&&e.layout==="column"){delete e.layout;e.layout={};e.layoutConfig={};e.layout="table";e.layoutConfig.columns=e.columnNumber;e.layoutConfig.tableAttrs={};e.layoutConfig.tableAttrs.style={};e.layoutConfig.tableAttrs.style["float"]="left";delete e.columnNumber;delete e.columnWidths}this.widgetContainer=new Sbi.console.WidgetContainer({storeManager:e.storeManager});if(e.storeManager){delete e.storeManager}if(e.items!==undefined){this.widgetContainer.register(e.items);var a=e.items[0];delete e.items}Ext.apply(this,e);Sbi.console.WidgetPanel.superclass.constructor.call(this,e)};Ext.extend(Sbi.console.WidgetPanel,Sbi.console.Widget,{widgetContainer:null,addWidget:function(a){this.widgetContainer.register(a)},onRender:function(b,a){Sbi.console.WidgetPanel.superclass.onRender.call(this,b,a);this.items.each(function(d){this.items.remove(d);d.destroy()},this);var c=this.widgetContainer.getWidgets();c.each(function(g,d,e){this.add(g)},this)}});Ext.chart.Chart.CHART_URL="/SpagoBIConsoleEngine/swf/yuichart/charts.swf";Ext.ns("Sbi.console");Sbi.console.ChartWidget=function(a){var b={height:170,dataset:"testStore",widgetConfig:{type:"chart.ext.line",xField:"name",yField:"visits"}};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.chartWidget){b=Ext.apply(b,Sbi.settings.console.chartWidget)}var d=Ext.apply(b,a||{});if(d.dataset){if((typeof d.dataset)==="string"){d.storeName=d.dataset}else{d.storeConfig=d.dataset}delete d.dataset}Ext.apply(this,d);Sbi.console.ChartWidget.superclass.constructor.call(this,d)};Ext.extend(Sbi.console.ChartWidget,Sbi.console.Widget,{store:null,storeName:null,storeConfig:null,widgetConfig:null,chart:null,parentContainer:null,YUI_CHART_LINE:"chart.ext.line",YUI_CHART_BAR:"chart.ext.bar",YUI_CHART_PIE:"chart.ext.pie",SBI_CHART_SPEEDOMETER:"chart.sbi.speedometer",SBI_CHART_LIVELINES:"chart.sbi.livelines",SBI_CHART_MULTILEDS:"chart.sbi.multileds",SBI_CHART_SEMAPHORE:"chart.sbi.semaphore",OFC_CHART_BAR:"chart.of.bar",FCF_CHART_BAR:"chart.fcf.bar",onRender:function(b,a){Sbi.console.ChartWidget.superclass.onRender.call(this,b,a);if(!this.store){if(this.storeName){this.store=this.getStore(this.storeName)}else{if(this.storeConfig){alert("ChartWidget: sorry unable to create a private dataset from config")}else{return}}}if(!this.store.ready&&this.store.proxy){this.store.ready=true;this.store.load({params:{},callback:function(){this.store.ready=true},scope:this,add:false})}this.chart=null;if(this.store.ready===true){this.initChart()}else{this.store.on("load",this.initChart,this)}},initChart:function(){if(this.chart==null){this.store.un("load",this.initChart,this)}this.chart=this.createChart(this.widgetConfig);this.items.each(function(a){this.items.remove(a);a.destroy()},this);if(this.chart!==null){this.add(this.chart);this.doLayout()}},createChart:function(c){var b=null;c=c||{};var a=c.type;if(a===this.YUI_CHART_LINE){b=this.createLineChart(c)}else{if(a===this.YUI_CHART_BAR){b=this.createBarChart(c)}else{if(a===this.YUI_CHART_PIE){b=this.createPieChart(c)}else{if(a===this.SBI_CHART_SPEEDOMETER||a===this.SBI_CHART_LIVELINES||a===this.SBI_CHART_MULTILEDS||a===this.SBI_CHART_SEMAPHORE){c.domainTimeInterval=this.store.refreshTime;b=this.createSpagoBIChart(c)}else{if(a===this.OFC_CHART_BAR){b=this.createOFBarChart(c)}else{if(a===this.FCF_CHART_BAR){b=this.createFCFBarChart(c)}else{Sbi.Msg.showError("Chart type ["+a+"] not supported by [ChartWidget]")}}}}}}return b},createSpagoBIChart:function(a){a.store=this.store;a.xtype=a.type;delete a.type;return new Ext.Panel({height:this.height,items:[a],border:false,bodyBorder:false,hideBorders:true})},createLineChart:function(a){delete a.type;var b=Ext.apply({},a,{xtype:"linechart",xField:"category",yField:"value",store:this.store,listeners:{itemclick:function(c){}}});b.xField=this.getFieldNameByAlias(b.xField);b.yField=this.getFieldNameByAlias(b.yField);return new Ext.Panel({layout:"fit",height:this.height,items:b,border:false})},createBarChart:function(a){delete a.type;var b=Ext.apply({},a,{xtype:"columnchart",xField:"category",yField:"value",store:this.store,listeners:{itemclick:function(d){var c=this.store.getAt(d.index);alert("Item Selected","You chose "+c.get("column-2"))}}});b.xField=this.getFieldNameByAlias(b.xField);b.yField=this.getFieldNameByAlias(b.yField);return new Ext.Panel({layout:"fit",height:this.height,width:this.width,items:b})},createPieChart:function(a){delete a.type;var b=Ext.apply({},a,{xtype:"piechart",dataField:"value",categoryField:"category",store:this.store,extraStyle:{legend:{display:"bottom",padding:5,font:{family:"Tahoma",size:13}}}});b.categoryField=this.getFieldNameByAlias(b.categoryField);b.dataField=this.getFieldNameByAlias(b.dataField);return new Ext.Panel({layout:"fit",height:this.height,items:b})},createOFBarChart:function(a){return new Ext.Panel({layout:"fit",height:this.height,items:[new Sbi.chart.OpenFlashChart()]})},createFCFBarChart:function(a){return new Ext.Panel({layout:"fit",height:this.height,items:[new Sbi.chart.FusionFreeChart()]})},getFieldNameByAlias:function(a){var b;b=a;if(this.store.getFieldNameByAlias){b=this.store.getFieldNameByAlias(a);if(!b){Sbi.Msg.showError("Dataset ["+this.storeId+"] does not contain a field whose alias is  ["+a+"]","Error in chart configuration");b=a}}return b}});Ext.ns("Sbi.console");Sbi.console.SummaryPanel=function(e){var h={layout:"fit",region:"north",height:410,split:true,collapsible:true,collapseFirst:false};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.summaryPanel){h=Ext.apply(h,Sbi.settings.console.summaryPanel)}var m=Ext.apply(h,e||{});Ext.apply(this,m);var b=this.initWidgetPanelConfig(m);var d=new Sbi.console.WidgetPanel(b);m=Ext.apply(m,{items:[d]});Sbi.console.SummaryPanel.superclass.constructor.call(this,m);this.on("expand",this.expandPanel,this);var l=this.datasets;var g=this.isComposite;var a={};a={run:function(){var o=false;if(!g){for(var q=0,u=b.items.length;q<u;q++){var r=b.items[q].chart;if(r===undefined){break}for(var n=0,t=r.items.length;n<t;n++){var c=r.items.get(n);if(c!==null&&c!==undefined&&!c.isSwfReady){o=false;break}else{o=true}}if(!o){break}}}else{for(var q=0,u=b.items.length;q<u;q++){for(p=0;p<b.items[q].items.length;p++){var r=b.items[q].items.get(p).chart;if(r===undefined||r===null){break}for(var n=0,t=r.items.length;n<t;n++){var c=r.items.get(n);if(c!==null&&c!==undefined&&!c.isSwfReady){o=false;break}else{o=true}}if(!o){break}}if(!o){break}}}if(o&&q==u){if(b.storeManager!==null&&b.storeManager!==undefined){for(ds in l){var s=b.storeManager.getStore(ds);if(s!==undefined){s.stopped=false}}b.storeManager.forceRefresh();Ext.TaskMgr.stop(a)}}},interval:10};Ext.TaskMgr.start(a)};Ext.extend(Sbi.console.SummaryPanel,Ext.Panel,{services:null,datasets:[],isComposite:false,initWidgetPanelConfig:function(c){var e=c.layoutManagerConfig||{};e.executionContext=c.executionContext;e.storeManager=this.storeManager;e.items=[];for(var l=0,g=c.charts.length;l<g;l++){if(c.charts[l].widgetConfig.type==="chart.composite"){this.isComposite=true;e.layoutConfig=c.layoutManagerConfig.layoutConfig||{};e.layoutConfig.tableAttrs=c.layoutManagerConfig.layoutConfig.tableAttrs||{style:{width:"100%"}};var m={};var n=e.defaults.dataset;var s=(e.defaults.columnWidthDefault===undefined)?0.1:e.defaults.columnWidthDefault;var a=(e.defaults.columnHeightDefault===undefined)?0.1:e.defaults.columnHeightDefault;if(c.charts[l].widgetConfig.linkableDoc!==undefined){m.title=(c.charts[l].widgetConfig.linkableDoc.text===undefined)?"":c.charts[l].widgetConfig.linkableDoc.text}else{m.title=(c.charts[l].widgetConfig.title===undefined)?"":c.charts[l].widgetConfig.title}m.colspan=(c.charts[l].widgetConfig.colspan===undefined)?1:c.charts[l].widgetConfig.colspan;m.rowspan=(c.charts[l].widgetConfig.rowspan===undefined)?1:c.charts[l].widgetConfig.rowspan;componentDataset=c.charts[l].widgetConfig.dataset;var q=c.charts[l].widgetConfig.width;var o=c.charts[l].widgetConfig.height;m.storeManager=this.storeManager;m.items=[];for(var h=0,d=c.charts[l].widgetConfig.subcharts.length;h<d;h++){var r={};r=c.charts[l].widgetConfig.subcharts[h];if(r.dataset===undefined){if(componentDataset!==undefined){r.dataset=componentDataset}else{r.dataset=n}}this.datasets[r.dataset]=r.dataset;if(r.width===undefined){if(q!==undefined){r.width=q/d}else{r.width=s/d}}r.width=(r.width*m.colspan);if(r.width<=1){r.width="100%"}else{if(r.width===undefined||isNaN(r.width)){delete r.width}}if(r.height===undefined){if(o!==undefined){r.height=o}else{r.height=a}}r.height=(r.height*m.rowspan);if(r.height<=1){r.height="100%"}else{if(r.height===undefined||isNaN(r.height)){delete r.height}}r.executionContext=e.executionContext;m.width=(q>r.width)?q:r.width;m.height=(o>r.height)?o:r.height;m.linkableDoc=c.charts[l].linkableDoc;m.executionContext=e.executionContext;m.items.push(new Sbi.console.ChartWidget(r))}var b=new Sbi.console.WidgetPanel(m);e.items.push(b)}else{this.datasets[c.charts[l].dataset]=c.charts[l].dataset;e.items.push(new Sbi.console.ChartWidget(c.charts[l]))}}e.autoScroll={};e.autoScroll=true;return e},expandPanel:function(a){}});Ext.ns("Sbi.console");Sbi.console.DownloadLogsWindow=function(a){var b=Ext.apply({},a||{},{title:"Download windows",width:500,height:300,hasBuddy:false});if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.downloadLogsWindow){b=Ext.apply(b,Sbi.settings.console.downloadLogsWindow)}var d=Ext.apply(b,a||{});Ext.apply(this,d);this.initFormPanel(d.options);this.closeButton=new Ext.Button({text:LN("sbi.console.downloadlogs.btnClose"),handler:function(){this.close()},scope:this});this.downloadButton=new Ext.Button({text:LN("sbi.console.downloadlogs.btnDownload"),handler:function(){if(!this.checkParameters()){return}this.fireEvent("checked",this,this.target);this.close()},scope:this});d=Ext.apply(d,{layout:"fit",closeAction:"close",constrain:true,plain:true,modal:true,title:this.title,buttonAlign:"center",buttons:[this.closeButton,this.downloadButton],items:[this.formPanel]});Sbi.console.DownloadLogsWindow.superclass.constructor.call(this,d);this.addEvents("checked")};Ext.extend(Sbi.console.DownloadLogsWindow,Ext.Window,{serviceName:null,formPanel:null,initialDate:null,finalDate:null,initialTime:null,finalTime:null,paths:null,target:null,closeButton:null,downloadButton:null,downloadLogs:function(e,c,a,g){var b=document.getElementById("download-form");if(!b){var d=Ext.DomHelper;b=d.append(Ext.getBody(),{id:"download-form",tag:"form",method:"post",cls:"download-form"})}g=Ext.apply(g,{message:e.name,userId:Sbi.user.userId,BEGIN_DATE:this.initialDate.value,END_DATE:this.finalDate.value,BEGIN_TIME:this.initialTime.value,END_TIME:this.finalTime.value,DIRECTORY:(this.paths!==null)?this.paths.value:g.DIRECTORY});Ext.Ajax.request({url:g.URL,params:g,success:function(l,m){if(l!==undefined&&l.responseText!==undefined){var n=(this.paths===null)?g.DIRECTORY:this.paths.value;var h=g.URL+"&DIRECTORY="+n+"&BEGIN_DATE="+this.initialDate.value+"&END_DATE="+this.finalDate.value+"&BEGIN_TIME="+this.initialTime.value+"&END_TIME="+this.finalTime.value;if(g.PREFIX1!==undefined&&g.PREFIX1!==null){h+="&PREFIX1="+g.PREFIX1}if(g.PREFIX2!==undefined&&g.PREFIX2!==null){h+="&PREFIX2="+g.PREFIX2}b.action=h;b.submit()}else{Sbi.Msg.showError("Server response is empty","Service Error")}},failure:Sbi.exception.ExceptionHandler.onServiceRequestFailure,scope:this})},initFormPanel:function(m){var a=[];this.initialDate=new Ext.form.DateField({fieldLabel:LN("sbi.console.downloadlogs.initialDate"),width:150,format:"d/m",allowBlank:false});a.push(this.initialDate);this.initialTime=new Ext.form.TimeField({fieldLabel:LN("sbi.console.downloadlogs.initialTime"),width:150,increment:30,format:"H:i"});a.push(this.initialTime);this.finalDate=new Ext.form.DateField({fieldLabel:LN("sbi.console.downloadlogs.finalDate"),width:150,format:"d/m",allowBlank:false});a.push(this.finalDate);this.finalTime=new Ext.form.TimeField({fieldLabel:LN("sbi.console.downloadlogs.finalTime"),width:150,increment:30,format:"H:i"});a.push(this.finalTime);var g=m.staticParams.DIRECTORY;if(Ext.isArray(g)&&g.length>1){var d=[];var h=new Ext.data.JsonStore({fields:["name","value"],data:[]});for(var b=0,e=g.length;b<e;b++){var l={name:g[b],value:g[b]};d.push(l)}h.loadData(d,false);var c={width:350,displayField:"name",valueField:"value",fieldLabel:LN("sbi.console.downloadlogs.path"),typeAhead:true,triggerAction:"all",emptyText:"",selectOnFocus:false,validateOnBlur:false,allowBlank:false,mode:"local"};this.paths=new Ext.form.ComboBox(Ext.apply(c,{store:h}));a.push(this.paths)}else{this.paths=null}this.formPanel=new Ext.FormPanel({title:LN("sbi.console.downloadlogs.title"),margins:"50 50 50 50",labelAlign:"left",bodyStyle:"padding:5px",width:850,height:600,layout:"form",trackResetOnLoad:true,items:a})},checkParameters:function(){if(this.initialDate.getValue()===undefined||this.initialDate.getValue()===""){Sbi.Msg.showWarning(LN("sbi.console.downloadlogs.initialDateMandatory"));this.initialDate.focus();return false}if(this.initialTime.getValue()===undefined||this.initialTime.getValue()===""){Sbi.Msg.showWarning(LN("sbi.console.downloadlogs.initialTimeMandatory"));this.initialTime.focus();return false}if(this.finalDate.getValue()===undefined||this.finalDate.getValue()===""){Sbi.Msg.showWarning(LN("sbi.console.downloadlogs.finalDateMandatory"));this.finalDate.focus();return false}if(this.finalTime.getValue()===undefined||this.finalTime.getValue()===""){Sbi.Msg.showWarning(LN("sbi.console.downloadlogs.finalTimeMandatory"));this.finalTime.focus();return false}if(this.initialDate.getValue()>this.finalDate.getValue()){Sbi.Msg.showWarning(LN("sbi.console.downloadlogs.rangeInvalid"));this.initialDate.focus();return false}if(this.paths!==null&&(this.paths.getValue()===undefined||this.paths.getValue()==="")){Sbi.Msg.showWarning(LN("sbi.console.downloadlogs.pathsMandatory"));this.paths.focus();return false}return true}});Ext.ns("Sbi.console");Sbi.console.MasterDetailWindow=function(a){var b=Ext.apply({},a||{},{title:"Master/Detail windows",width:500,height:300,hasBuddy:false});if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.masterDetailWindow){b=Ext.apply(b,Sbi.settings.console.masterDetailWindow)}var d=Ext.apply(b,a||{});Ext.apply(this,d);this.initMainPanel(d);this.okButton=new Ext.Button({text:LN("sbi.console.error.btnClose"),handler:function(){this.hide()},scope:this});this.checkButton=new Ext.Button({text:"Mark as checked",handler:function(){this.hide();this.fireEvent("checked",this,this.target)},scope:this});d=Ext.apply(d,{layout:"fit",closeAction:"hide",constrain:true,plain:true,modal:true,title:this.title,buttonAlign:"center",buttons:[this.okButton,this.checkButton],items:[this.mainPanel]});Sbi.console.MasterDetailWindow.superclass.constructor.call(this,d);this.addEvents("checked")};Ext.extend(Sbi.console.MasterDetailWindow,Ext.Window,{mainPanel:null,masterPanel:null,grid:null,detailPanel:null,detailText:null,store:null,detailField:null,serviceName:null,target:null,okButton:null,checkButton:null,setTarget:function(a){this.target=a},reloadMasterList:function(a){this.clearDetailPanel();this.store.load({params:a})},clearDetailPanel:function(){this.detailText.reset()},initMainPanel:function(){this.initMasterlPanel();this.initDetailPanel();this.mainPanel=new Ext.Panel({layout:"border",frame:false,border:false,bodyStyle:"background:#E8E8E8;",style:"padding:3px;",items:[this.masterPanel,this.detailPanel]})},initMasterlPanel:function(){this.columnModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"Data",dataIndex:"data",width:100}]);this.store=new Sbi.data.Store({serviceName:this.serviceName,autoLoad:false});this.store.on("exception",Sbi.exception.ExceptionHandler.onStoreLoadException,this);this.store.on("metachange",function(b,e){var c;var d=Ext.apply({},e);this.detailField=d.detailProperty;var a=d.fields;d.fields=new Array(a.length);for(c=0;c<a.length;c++){if((typeof a[c])==="string"){a[c]={name:a[c]}}d.fields[c]=Ext.apply({},a[c])}d.fields[0]=new Ext.grid.RowNumberer();this.grid.getColumnModel().setConfig(d.fields)},this);this.grid=new Ext.grid.GridPanel({layout:"fit",title:this.action.titleWin,loadMask:true,viewConfig:{forceFit:false,autoFill:true,enableRowBody:true,showPreview:true},store:this.store,cm:this.columnModel});this.grid.on("rowclick",function(b,g,c){var a=this.store.getAt(g);if(!this.detailField){return}var d=a.get(this.detailField);if(!d){return}d=d.replace(/</g,"\n <");this.detailText.setValue(d)},this);this.masterPanel=new Ext.Panel({region:"north",split:true,frame:false,border:false,height:120,bodyStyle:"padding:5px;background:#E8E8E8;border-width:1px;border-color:#D0D0D0;",style:"padding-bottom:3px",items:[this.grid]});this.store.on("load",function(){this.grid.setHeight(this.masterPanel.getSize().height-12);this.grid.setWidth(this.masterPanel.getSize().width-12)},this);this.masterPanel.on("resize",function(c,b,e,a,d){this.grid.setHeight(this.masterPanel.getSize().height-12);this.grid.setWidth(this.masterPanel.getSize().width-12)},this)},initDetailPanel:function(){this.detailText=new Ext.form.TextArea({autoScroll:true});this.detailText.setReadOnly(true);this.detailPanel=new Ext.Panel({region:"center",frame:false,border:false,autoScroll:false,height:"auto",items:[new Ext.Panel({layout:"fit",bodyStyle:"padding:5px;background:#E8E8E8;border-width:1px;border-color:#D0D0D0;",items:[this.detailText]})]});this.detailPanel.on("resize",function(c,b,e,a,d){this.detailText.setHeight(this.detailPanel.getSize().height-12)},this)}});Ext.ns("Sbi.console");Sbi.console.WaitWindow=function(a){var b=Ext.apply({},a||{},{title:"Please wait",width:500,height:150,hasBuddy:false});if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.waitWindow){b=Ext.apply(b,Sbi.settings.console.waitWindow)}var d=Ext.apply(b,a||{});Ext.apply(this,d);this.initMainPanel(d);this.okButton=new Ext.Button({text:LN("sbi.console.error.btnClose"),handler:function(){this.hide()},scope:this});d=Ext.apply(d,{layout:"fit",closeAction:"hide",constrain:true,plain:true,modal:true,title:this.title,buttonAlign:"center",buttons:[this.okButton],items:[this.mainPanel]});Sbi.console.WaitWindow.superclass.constructor.call(this,d)};Ext.extend(Sbi.console.WaitWindow,Ext.Window,{mainPanel:null,okButton:null,statusText:null,startingTxt:"Please wait, somethings is happening at the server side",startedTxt:"Server side finished to do whatever it was doing",progressTickNo:null,start:function(){this.progressTickNo=0;this.statusText.setText(this.startingTxt);this.okButton.disable();this.progressBar.wait({interval:200,increment:15})},stop:function(a){this.progressBar.reset();this.progressBar.updateProgress(1,"",true);this.statusText.setText(a||this.startedTxt);this.okButton.enable()},initMainPanel:function(){this.progressBar=new Ext.ProgressBar({});this.progressBar.on("update",function(c){this.progressTickNo++;var a=this.progressTickNo%5;var d=".";for(var b=0;b<a;b++){d+="."}this.statusText.setText(this.startingTxt+d)},this);this.statusText=new Ext.form.Label({text:"Proecess is starting up ...",style:"padding-top:10px;font-size:16;"});this.mainPanel=new Ext.Panel({layout:{type:"vbox",padding:"10",align:"stretch"},frame:false,border:false,bodyStyle:"background:#E8E8E8;",style:"padding:3px;",items:[this.progressBar,this.statusText]})}});Ext.ns("Sbi.console");Sbi.console.NavigationToolbar=function(b){var d={};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.navigationToolbar){d=Ext.apply(d,Sbi.settings.console.navigationToolbar)}var e=Ext.apply(d,b||{});var a=e.documents||[];a.executionContext=e.executionContext;delete e.documents;delete e.executionContext;Ext.apply(this,e);this.initToolbarButtons(a);e=Ext.apply(e,{items:this.toolbarButtons});Sbi.console.NavigationToolbar.superclass.constructor.call(this,e)};Ext.extend(Sbi.console.NavigationToolbar,Ext.Toolbar,{services:null,toolbarButtons:null,initToolbarButtons:function(b){this.toolbarButtons=[];for(var c=0,a=b.length;c<a;c++){var e=b[c];this.toolbarButtons.push({text:e.text,tooltip:e.tooltip,documentConf:e,executionContext:b.executionContext,handler:this.execCrossNavigation,scope:this})}},execCrossNavigation:function(a){if(sendMessage===undefined){Sbi.Msg.showError("function [sendMessage] is not defined","Cross navigation error");return}if((typeof sendMessage)!=="function"){Sbi.Msg.showError("[sendMessage] is not a function","Cross navigation error");return}var m={label:a.documentConf.label,windowName:this.name};var h="";if(a.documentConf.staticParams){m.parameters="";for(p in a.documentConf.staticParams){m.parameters+=h+p+"="+a.documentConf.staticParams[p];h="&"}}if(a.documentConf.dynamicParams){var d="";for(var g=0,c=a.documentConf.dynamicParams.length;g<c;g++){var e=a.documentConf.dynamicParams[g];for(p in e){if(p!="scope"){if(e.scope==="env"){if(a.executionContext[p]===undefined){d+='Parameter "'+p+'" undefined into request. <p>'}else{m.parameters+=h+e[p]+"="+a.executionContext[p];h="&"}}}}if(d!=""){Sbi.Msg.showError(d,"Service Error")}}}sendMessage(m,"crossnavigation")}});Ext.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};Ext.grid.CheckColumn.prototype={init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(d,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){d.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);a.set(this.dataIndex,!a.data[this.dataIndex])}},renderer:function(b,c,a){c.css+=" x-grid3-check-col-td";return'<div class="x-grid3-check-col'+(b?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'}};Ext.grid.ButtonColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};Ext.grid.ButtonColumn.prototype={init:function(b){this.grid=b;if(this.grid.rendered===true){var a=this.grid.getView();a.mainBody.on("click",this.onClick,this)}else{this.grid.on("render",function(){var c=this.grid.getView();c.mainBody.on("click",this.onClick,this)},this)}},onClick:function(b,a){if(a.className&&a.className.indexOf("x-mybutton-"+this.id)!=-1){b.stopEvent();this.clickHandler(b,a)}},clickHandler:function(d,c){var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b)},renderer:function(b,c,a){return'<center><img class="x-mybutton-'+this.id+'" width="13px" height="13px" src="'+this.imgSrc+'" title= "'+this.tooltip+'"/></center>'}};Ext.ns("Sbi.console");Sbi.console.InlineActionColumn=function(a){a=Ext.apply({hideable:true,width:25},a||{});a.options=a.config;a.tooltip=a.tooltip||{};a.handler=a.handler||Ext.emptyFn;a.scope=a.scope||this;delete a.config;Ext.apply(this,a);if(!this.id){this.id=Ext.id()}if(!this.dataIndex){this.dataIndex=this.name+"_"+this.id}this.renderer=this.renderer.createDelegate(this);Sbi.console.InlineActionColumn.superclass.constructor.call(this,a);if(this.grid){this.init(this.grid)}};Ext.extend(Sbi.console.InlineActionColumn,Ext.util.Observable,{grid:null,name:null,options:null,handler:null,scope:null,flagColumn:null,UNFLAGGED_VALUE:0,isActive:function(a){var d=true;if(this.flagColumn){var b,c;c=this.grid.store;b=a.get(c.getFieldNameByAlias(this.flagColumn));if(b===undefined||b===null){Sbi.Msg.showError("Impossible to draw button column ["+this.dataIndex+"]. Dataset ["+c.storeId+"]does not contain column ["+this.flagColumn+"]")}d=(this.UNFLAGGED_VALUE!==b)}return d},init:function(b){this.grid=b;if(this.grid.rendered===true){var a=this.grid.getView();a.mainBody.on("click",this.onClick,this)}else{this.grid.on("render",function(){var c=this.grid.getView();c.mainBody.on("click",this.onClick,this)},this)}},onClick:function(d,c){if(c.className&&c.className.indexOf("x-mybutton-"+this.id)!=-1){d.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);this.handler.call(this.scope,this,a,b,this.options)}},renderer:function(b,c,a){if(this.isActive(a)===false){return""}return'<center><img class="x-mybutton-'+this.id+'" width="13px" height="13px" src="'+this.imgSrc+'" title= "'+this.tooltip+'"/></center>'}});Ext.ns("Sbi.console");Sbi.console.InlineToggleActionColumn=function(a){Sbi.console.InlineToggleActionColumn.superclass.constructor.call(this,a)};Ext.extend(Sbi.console.InlineToggleActionColumn,Sbi.console.InlineActionColumn,{toggleOnClick:true,checkColumn:null,CHECKED_VALUE:1,UNCHECKED_VALUE:0,isBoundToColumn:function(){return(this.checkColumn!==null)},getBoundColumnValue:function(a){var b,c;c=this.grid.store;b=a.get(c.getFieldNameByAlias(this.checkColumn));if(b===undefined||b===null){Sbi.Msg.showError("Impossible to draw toggle column ["+this.dataIndex+"]. Dataset ["+c.storeId+"]does not contain column ["+this.checkColumn+"]")}return b},setBoundColumnValue:function(a,c){var b;b=this.grid.store;a.set(b.getFieldNameByAlias(this.checkColumn),c)},isChecked:function(a){var b,c;if(this.isBoundToColumn()){b=this.getBoundColumnValue(a);c=(b===this.CHECKED_VALUE)}return c},setChecked:function(c,a){if(this.isBoundToColumn()){this.setBoundColumnValue(c,(a?this.CHECKED_VALUE:this.UNCHECKED_VALUE))}},toggle:function(a){this.setChecked(a,!this.isChecked(a))},onClick:function(d,c){if(c.className&&c.className.indexOf("x-mybutton-"+this.id)!=-1){d.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);if(!this.isChecked(a)||this.singleExecution===undefined||this.singleExecution==false){if(this.toggleOnClick){this.toggle(a)}this.handler.call(this.scope,this,a,b,this.options)}}},renderer:function(b,c,a){if(this.isActive(a)===false){return""}if(this.isChecked(a)){img='<center><img class="x-mybutton-'+this.id+'" width="13px" height="13px" src="'+this.imgSrcInactive+'" title= "'+this.tooltipInactive+'"/></center>'}else{img='<center><img class="x-mybutton-'+this.id+'" width="13px" height="13px" src="'+this.imgSrcActive+'" title= "'+this.tooltipActive+'"/></center>'}return img}});Ext.ns("Sbi.console");Sbi.console.InlineCheckColumn=function(a){a=Ext.apply({hideable:true,width:25},a||{});a.tooltip=a.tooltip||{};a.handler=a.handler||Ext.emptyFn;a.scope=a.scope||this;delete a.config;Ext.apply(this,a);if(!this.id){this.id=Ext.id()}if(!this.dataIndex){this.dataIndex=this.name+"_"+this.id}this.renderer=this.renderer.createDelegate(this);Sbi.console.InlineCheckColumn.superclass.constructor.call(this,a);if(this.grid){this.init(this.grid)}};Ext.extend(Sbi.console.InlineCheckColumn,Ext.util.Observable,{grid:null,handler:null,scope:null,masterCheckValue:null,listRowsSelected:[],flagColumn:null,UNFLAGGED_VALUE:0,CHECKED_VALUE:1,UNCHECKED_VALUE:0,isActive:function(a){var d=true;if(this.flagColumn){var b,c;c=this.grid.store;b=a.get(c.getFieldNameByAlias(this.flagColumn));if(b===undefined||b===null){Sbi.Msg.showError("Impossible to draw check column ["+this.dataIndex+"]. Dataset ["+c.storeId+"]does not contain column ["+this.flagColumn+"]")}d=(this.UNFLAGGED_VALUE!==b)}return d},setChecked:function(a,d){this.masterCheckValue=(a)?this.CHECKED_VALUE:this.UNCHECKED_VALUE;var e=this.grid.store;var c=d.get(e.getFieldNameByAlias(this.flagColumn));var g=(c===1||c==="1")?"true":"1";d.set(e.getFieldNameByAlias(this.flagColumn),g)},init:function(b){this.grid=b;if(this.grid.rendered===true){var a=this.grid.getView();a.mainBody.on("click",this.onClick,this)}else{this.grid.on("render",function(){var c=this.grid.getView();c.mainBody.on("click",this.onClick,this)},this)}},toggle:function(a){this.setChecked(this.masterCheckValue,a)},onClick:function(g,c){if(c.className&&(c.className.indexOf("x-mygrid3-check-col-"+this.id)!=-1||c.className.indexOf("x-mygrid3-check-col-on-"+this.id)!=-1)){g.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);var d=this.grid.store;this.updateValuesList(a.get(d.getFieldNameByAlias(this.columnID)));this.toggle(a);this.handler.call(this.scope,this.listRowsSelected)}},updateValuesList:function(b){var a=false;var c=this.getPositionEl(b,this.listRowsSelected);if(c!=-1){delete this.listRowsSelected[c];a=true;this.masterCheckValue=this.UNCHECKED_VALUE}if(!a){this.listRowsSelected.push(b);this.masterCheckValue=this.CHECKED_VALUE}},getPositionEl:function(c,a){var d=-1;if(a==null){return d}for(var b=0;b<a.length;b++){if(a[b]==c){d=b;break}}return d},renderer:function(b,e,a){var c=this.grid.store;var d=a.get(c.getFieldNameByAlias(this.columnID));if(this.grid.isDirty||this.grid.isDisable){this.listRowsSelected=this.grid.selectedRowsId}var h=this.getPositionEl(d,this.grid.hideSelectedRow);if(this.isActive(a)===false||h!==-1){this.grid.isDisable=false;return""}e.css+=" x-grid3-check-col-td";var g="";if(d==undefined||this.getPositionEl(d,this.listRowsSelected)==-1){g='<div class="x-grid3-check-col x-mygrid3-check-col-'+this.id+ +'" title= "'+this.tooltipInactive+'">&#160;</div>'}else{g='<div class="x-grid3-check-col-on x-mygrid3-check-col-on-'+this.id+ +'" title= "'+this.tooltipActive+'">&#160;</div>'}return g}});Ext.ns("Sbi.console");Sbi.console.ActionButton=function(a){var b={iconCls:a.actionConf.type,tooltip:(a.actionConf.tooltip===undefined)?a.actionConf.type:a.actionConf.tooltip,hidden:a.actionConf.hidden,scope:this};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.actionButton){b=Ext.apply(b,Sbi.settings.console.actionButton)}var d=Ext.apply(b,a||{});Ext.apply(this,d);this.initServices();d=Ext.apply(d,this);Sbi.console.ActionButton.superclass.constructor.call(this,d);this.on("click",this.execAction,this);this.store.on("load",this.initButton,this);this.addEvents("toggleIcons")};Ext.extend(Sbi.console.ActionButton,Ext.Button,{services:null,isActive:null,ACTIVE_VALUE:1,INACTIVE_VALUE:0,USER_ID:"userId",ERRORS:"errors",ALARMS:"alarms",VIEWS:"views",MONITOR:"monitor",MONITOR_INACTIVE:"monitor_inactive",SELECT_ROWS:"selectRow",UNSELECT_ROWS:"unselectRow",INVERT_SELECT_ROWS:"invertSelectionRow",loadMask:null,columnID:null,FILTERBAR_ACTIONS:{monitor:{serviceName:"UPDATE_ACTION",images:"monitor"},monitor_inactive:{serviceName:"UPDATE_ACTION",images:"monitor_inactive"},errors:{serviceName:"UPDATE_ACTION",images:{active:"errors",inactive:"errors_inactive"}},alarms:{serviceName:"UPDATE_ACTION",images:{active:"alarms",inactive:"alarms_inactive"}},views:{serviceName:"UPDATE_ACTION",images:{active:"views",inactive:"views_inactive"}},refresh:{serviceName:"REFRESH_ACTION",images:{active:"refresh",inactive:"refresh"}}},resolveParameters:function(t,c){var m={};m=Ext.apply(m,t.staticParams);var b=t.dynamicParams;if(b){var u="";var q=false;for(var n=0,e=b.length;n<e;n++){var d=b[n];if(d.useSelectedRow!==undefined&&d.useSelectedRow==true){q=true}for(p in d){if(p==="scope"){continue}if(p==="useSelectedRow"){continue}if(d.scope==="env"){var o=d[p];if(q){var h=this.ownerCt;var g=h.ownerCt;var a=this.cleanList(g.selectedRowsId);if(a==null||a.length==0){var r='Parameter "'+o+'" has not values selected. Default value is used.<p>';Sbi.Msg.showWarning(r,"Service Warning")}else{m[p]=a;this.columnID=o}q=false}else{if(p!==this.USER_ID&&c[o]===undefined){}else{if(!q){m[p]=c[o]}}}}}}var s=t.metaParams;if(s){m.metaParams=Ext.util.JSON.encode(s)}if(u!=""){Sbi.Msg.showError(u,"Service Error")}}return m},cleanList:function(a){var e=[];if(a==null){return a}for(var c=0,b=a.length;c<b;c++){var d=a[c];if(d!==undefined&&d!==""){e.push(d)}}return e},execAction:function(){if(this.actionConf.singleExecution!==undefined&&this.actionConf.singleExecution==true&&(this.isActive!==undefined&&this.isActive==false)){return}if(this.actionConf.msgConfirm!==undefined&&this.actionConf.msgConfirm!==""){Ext.MessageBox.confirm("Confirm",this.actionConf.msgConfirm,function(a,b){if(a=="yes"){this.execRealAction()}},this)}else{this.execRealAction()}},initServices:function(){this.services=this.services||new Array();this.images=this.images||new Array();for(var a in this.FILTERBAR_ACTIONS){var b=this.FILTERBAR_ACTIONS[a];this.services[a]=this.services[a]||Sbi.config.serviceRegistry.getServiceUrl({serviceName:b.serviceName,baseParams:new Object()})}},initButton:function(){if(this.actionConf.type===this.MONITOR||this.actionConf.type===this.MONITOR_INACTIVE){return}if(this.actionConf.type===this.SELECT_ROWS||this.actionConf.type===this.UNSELECT_ROWS||this.actionConf.type===this.INVERT_SELECT_ROWS){if(this.actionConf.imgSrc!==undefined){var c=this.actionConf.imgSrc.substr(0,this.actionConf.imgSrc.indexOf("."));if(Ext.util.CSS.getRule("."+c)==null){Ext.util.CSS.createStyleSheet("."+c+" { background-image: url(../img/"+this.actionConf.imgSrc+") !important; }")}this.setIconClass(c)}return}if(this.actionConf.type===this.ERROR||this.actionConf.type===this.ALARMS||this.actionConf.type===this.VIEWS&&this.actionConf.flagColumn!==undefined){var b=this.store.getFieldNameByAlias(this.actionConf.flagColumn);if(b===undefined){return}else{var e=this.store.findExact(b,this.ACTIVE_VALUE);if(e===-1){this.hide();return}}}var a=this.store.getFieldNameByAlias(this.actionConf.checkColumn);if(a!==undefined){var d=this.store.findExact(a,this.INACTIVE_VALUE);if(d>-1){if(this.actionConf.imgSrcActive!==undefined){var c=this.actionConf.imgSrcActive.substr(0,this.actionConf.imgSrcActive.indexOf("."));if(Ext.util.CSS.getRule("."+c)==null){Ext.util.CSS.createStyleSheet("."+c+" { background-image: url(../img/"+this.actionConf.imgSrcActive+") !important; }")}this.setIconClass(c)}else{this.setIconClass(this.FILTERBAR_ACTIONS[this.actionConf.type].images.active)}this.isActive=true;this.setTooltip(this.actionConf.tooltipInactive)}else{if(this.actionConf.imgSrcInactive!==undefined){var c=this.actionConf.imgSrcInactive.substr(0,this.actionConf.imgSrcInactive.indexOf("."));if(Ext.util.CSS.getRule("."+c)==null){Ext.util.CSS.createStyleSheet("."+c+" { background-image: url(../img/"+this.actionConf.imgSrcInactive+") !important; }")}this.setIconClass(c)}else{this.setIconClass(this.FILTERBAR_ACTIONS[this.actionConf.type].images.inactive)}this.isActive=false;this.setTooltip(this.actionConf.tooltipActive)}}else{if(this.actionConf.imgSrcActive!==undefined){var c=this.actionConf.imgSrcActive.substr(0,this.actionConf.imgSrcActive.indexOf("."));if(Ext.util.CSS.getRule("."+c)==null){Ext.util.CSS.createStyleSheet("."+c+" { background-image: url(../img/"+this.actionConf.imgSrcActive+") !important; }")}this.setIconClass(c)}else{this.setIconClass(this.FILTERBAR_ACTIONS[this.actionConf.type].images.active)}this.isActive=true;this.setTooltip(this.actionConf.tooltipInactive)}},setCheckValue:function(n,q,a){var e=this.ownerCt;var d=e.ownerCt;if(d.selectedRowsId==null){d.selectedRowsId=[]}if(this.actionConf.hideSelectedRow!==undefined&&this.actionConf.hideSelectedRow==true&&d.hideSelectedRow==null){d.hideSelectedRow=[]}var r=d.store;for(var h=0,c=r.getCount();h<c;h++){var m=r.getAt(h);var o=m.get(r.getFieldNameByAlias(this.columnID));if(a){var g=e.getPositionEl(o,d.hideSelectedRow);if(g!==-1){d.isDisable=true;d.isDirty=false}else{d.isDisable=false;d.isDirty=true}}m.set(r.getFieldNameByAlias(n),q)}if(q===this.ACTIVE_VALUE){if(this.actionConf.imgSrcInactive!==undefined){var b=this.actionConf.imgSrcInactive.substr(0,this.actionConf.imgSrcInactive.indexOf("."));if(Ext.util.CSS.getRule("."+b)==null){Ext.util.CSS.createStyleSheet("."+b+" { background-image: url(../img/"+this.actionConf.imgSrcInactive+") !important; }")}this.setIconClass(b)}else{this.setIconClass(this.FILTERBAR_ACTIONS[this.actionConf.type].images.inactive)}this.isActive=false}else{if(this.actionConf.imgSrcActive!==undefined){var b=this.actionConf.imgSrcActive.substr(0,this.actionConf.imgSrcActive.indexOf("."));if(Ext.util.CSS.getRule("."+b)==null){Ext.util.CSS.createStyleSheet("."+b+" { background-image: url(../img/"+this.actionConf.imgSrcActive+") !important; }")}this.setIconClass(b)}else{this.setIconClass(this.FILTERBAR_ACTIONS[this.actionConf.type].images.active)}this.isActive=true}},execRealAction:function(){checkCol=this.actionConf.checkColumn;if(this.actionConf.type==="selectRow"||this.actionConf.type==="unselectRow"||this.actionConf.type==="invertSelectionRow"){this.fireEvent("toggleIcons",this,null);return}else{if(this.actionConf.type==="monitor"||this.actionConf.type==="monitor_inactive"){this.store.filterPlugin.removeFilter(this.store.getFieldNameByAlias(this.actionConf.checkColumn));var b=new Array();b.push((this.actionConf.type==="monitor")?this.ACTIVE_VALUE:this.INACTIVE_VALUE);this.store.filterPlugin.addFilter(this.store.getFieldNameByAlias(this.actionConf.checkColumn),b);this.store.filterPlugin.applyFilters();this.hideMask();return}else{if(this.actionConf.type==="refresh"){if(this.store.pagingParams&&this.store.pagingParams.paginator){if(this.store.lastParams){delete this.store.lastParams}var d=this.store.pagingParams.paginator;d.doLoad(d.cursor)}else{this.store.loadStore()}var a=this.ownerCt;a.ownerCt.selectedRowsId=[];a.ownerCt.hideSelectedRow=[];a.ownerCt.isDisable=false;a.ownerCt.isDirty=true;this.hideMask();return}else{if(this.actionConf.type==="errors"||this.actionConf.type==="errors_inactive"){if(this.isActive!==undefined&&this.isActive==true){flgCheck=this.ACTIVE_VALUE}else{if(this.isActive!==undefined&&this.isActive==false){flgCheck=this.INACTIVE_VALUE}else{flgCheck=(this.iconCls==="errors")?this.ACTIVE_VALUE:this.INACTIVE_VALUE}}}else{if(this.actionConf.type==="alarms"||this.actionConf.type==="alarms_inactive"){if(this.isActive!==undefined&&this.isActive==true){flgCheck=this.ACTIVE_VALUE}else{if(this.isActive!==undefined&&this.isActive==false){flgCheck=this.INACTIVE_VALUE}else{flgCheck=(this.iconCls==="alarms")?this.ACTIVE_VALUE:this.INACTIVE_VALUE}}}else{if(this.actionConf.type==="views"||this.actionConf.type==="views_inactive"){if(this.isActive!==undefined&&this.isActive==true){flgCheck=this.ACTIVE_VALUE}else{if(this.isActive!==undefined&&this.isActive==false){flgCheck=this.INACTIVE_VALUE}else{flgCheck=(this.iconCls==="views")?this.ACTIVE_VALUE:this.INACTIVE_VALUE}}}}}}}}if(flgCheck!=null&&flgCheck===this.INACTIVE_VALUE&&this.actionConf.singleExecution!==undefined&&this.actionConf.singleExecution==true){this.hideMask();return}this.executionContext[checkCol]=flgCheck;var c=this.resolveParameters(this.actionConf.config,this.executionContext);c=Ext.apply(c,{message:this.actionConf.type,userId:Sbi.user.userId});this.showMask();Ext.Ajax.request({url:this.services[this.actionConf.type],params:c,success:function(g,h){if(g!==undefined&&g.responseText!==undefined){var l=Ext.util.JSON.decode(g.responseText);if(l!==undefined){}this.hideMask();this.updateHideSelectedRowList();if(this.refreshDataAfterAction!==undefined&&this.refreshDataAfterAction===true){var e=this.ownerCt;e.ownerCt.selectedRowsId=[];e.ownerCt.isDisable=false;e.ownerCt.isDirty=true;this.store.loadStore()}else{this.setCheckValue(this.actionConf.checkColumn,flgCheck,true);this.fireEvent("toggleIcons",this,flgCheck)}}else{this.hideMask();Sbi.Msg.showError("Server response is empty","Service Error")}},failure:function(e,g){this.hideMask();Sbi.exception.ExceptionHandler.onServiceRequestFailure(e,g)},scope:this})},updateHideSelectedRowList:function(){var c=this.ownerCt;var g=c.ownerCt;var e=false;if(this.actionConf.hideSelectedRow!==undefined&&this.actionConf.hideSelectedRow==true){e=true}if(e&&g.hideSelectedRow==null){g.hideSelectedRow=[]}for(var d=0,b=g.selectedRowsId.length;d<b;d++){var a=g.selectedRowsId[d];var h=c.getPositionEl(a,g.hideSelectedRow);delete g.selectedRowsId[d];if(h==-1&&e){g.hideSelectedRow.push(a)}}},showMask:function(){this.un("afterlayout",this.showMask,this);if(this.loadMask==null){this.loadMask=new Ext.LoadMask(Ext.getBody(),{msg:"Loading.."})}if(this.loadMask){this.loadMask.show()}},hideMask:function(){if(this.loadMask&&this.loadMask!=null){this.loadMask.hide()}}});Ext.ns("Sbi.console");Sbi.console.FilteringToolbar=function(a){var b={autoWidth:true,width:"100%",filters:{}};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.filteringToolbar){b=Ext.apply(b,Sbi.settings.console.filteringToolbar)}var d=Ext.apply(b,a||{});Ext.apply(this,d);this.services=this.services||new Array();this.services.createexportfile=this.services.createexportfile||Sbi.config.serviceRegistry.getServiceUrl({serviceName:"CREATE_EXPORT_FILE_ACTION",baseParams:new Object()});this.services.getexportfile=this.services.getexportfile||Sbi.config.serviceRegistry.getServiceUrl({serviceName:"GET_TEMPORARY_FILE_ACTION",baseParams:new Object()});Sbi.console.FilteringToolbar.superclass.constructor.call(this,d);this.addEvents("beforefilterselect")};Ext.extend(Sbi.console.FilteringToolbar,Ext.Toolbar,{services:null,store:null,filterStores:null,cbFilters:null,buttons:[],onRender:function(b,a){Sbi.console.FilteringToolbar.superclass.onRender.call(this,b,a)},addActionButtons:function(){var o;var m={};m.executionContext=this.filterBar.executionContext;var q=this.filterBar.exportName;m.store=this.store;m.refreshDataAfterAction=this.filterBar.refreshDataAfterAction;this.addFill();if(this.filterBar.actions){for(var g=0;g<this.filterBar.actions.length;g++){if(this.filterBar.actions[g].type==undefined){this.filterBar.actions[g].type=this.filterBar.actions[g].name}m.actionConf=this.filterBar.actions[g];m.actionConf.tooltip=Sbi.locale.getLNValue(m.actionConf.tooltip);m.actionConf.tooltipInactive=Sbi.locale.getLNValue(m.actionConf.tooltipInactive);m.actionConf.tooltipActive=Sbi.locale.getLNValue(m.actionConf.tooltipActive);m.actionConf.msgConfirm=Sbi.locale.getLNValue(m.actionConf.msgConfirm);o=new Sbi.console.ActionButton(m);o.on("toggleIcons",this.onToggleIcons,this);this.addButton(o);this.buttons.push(o)}}var a=new Array();var h=new Array();h.push("XLS");h.push("CSV");var c=null;if(h.length!=1){for(k=0;k<h.length;k++){var n=h[k];var e="icon-"+n.toLowerCase();var l=new Ext.menu.Item({text:n,group:"group_2",iconCls:e,width:15,scope:this,docType:n,href:"",exportName:q});l.addListener("click",this.exportConsole,this,n);a.push(l)}var d=new Ext.menu.Menu({id:"basicMenu_0",items:a});c=new Ext.Toolbar.Button({tooltip:"Exporters",path:"Exporters",iconCls:"icon-export",menu:d,width:15,cls:"x-btn-menubutton x-btn-text-icon bmenu "})}else{var n=h[0];var e="icon-"+n.toLowerCase();c=new Ext.Toolbar.Button({text:n,group:"group_2",iconCls:e,scope:this,width:15,href:"",docType:n});c.addListener("click",this.exportConsole,this,n)}this.addButton(c)},exportConsole:function(t){var q=t.docType;var s=t.exportName;var h=this.ownerCt;var m=h.columnConfig;var o=h.colModel.fields;var l=h.store.reader.meta.fields;var d;var g=new Array();if(h.datasetExport!=null){d=h.datasetExport.datasetExp||"";var n=h.datasetExport.columnConfig;for(p in n){var c={};c[p]=n[p];g.push(c)}}var a=(h.storeLabels!==undefined&&h.storeLabels!==null)?h.storeLabels.dsLabel:"";var r=new Array();for(p in m){var c={};c[p]=m[p];r.push(c)}if(h.datasetExport!=null){d=h.datasetExport.datasetExp||"";var n=h.datasetExport.columnConfig;for(p in n){var c={};c[p]=n[p];g.push(c)}}var b="application/vnd.ms-excel";if(q=="PDF"){b="application/pdf"}if(q=="CSV"){b="text/csv"}if(s==undefined){s=""}var e=null;if(h.datasetExport!=null){e={mimeType:b,datasetLabel:d,datasetHeadersLabel:a,meta:Ext.util.JSON.encode(g),exportName:s}}else{e={mimeType:b,datasetLabel:h.store.dsLabel,datasetHeadersLabel:a,meta:Ext.util.JSON.encode(r),exportName:s}}this.ownerCt.stopLoading();this.ownerCt.showMask();Ext.Ajax.request({url:this.services.createexportfile,params:e,success:this.onExportFileSuccess,failure:this.onExportFileFailure,scope:this})},onExportFileSuccess:function(b,c){this.ownerCt.hideMask();this.ownerCt.restartLoading();if(b!==undefined&&b.responseText!==undefined){var a=Ext.util.JSON.decode(b.responseText);Sbi.Sync.request({url:this.services.getexportfile,params:{name:a.name,extension:a.extension}})}else{Sbi.Msg.showError("Server response is empty","Service Error")}},onExportFileFailure:function(a,b){this.ownerCt.hideMask();this.ownerCt.restartLoading();Sbi.exception.ExceptionHandler.onServiceRequestFailure(a,b)},orderMetaColumns:function(g,b,l){var m=new Array();if(g!=null&&g!==undefined){for(i=0;i<g.length;i++){var e=g[i];if(e!==undefined&&e.dataIndex!==""){var c=e.header;for(j=0;j<b.length;j++){var d=b[j];if(d!==undefined&&(e.dataIndex==d.dataIndex)){var h=d.header;var a={};a[h]=l[h];m.push(a);break}}}}}return m},createFilterField:function(a,d,l){if(a==="EQUALS_TO"){this.filterStores=this.filterStores||{};this.cbFilters=this.cbFilters||{};var n=new Ext.data.JsonStore({fields:["name","value","description"],data:[]});this.filterStores[l]=n;var c={width:130,displayField:"name",valueField:"value",typeAhead:true,triggerAction:"all",emptyText:"...",selectOnFocus:false,validateOnBlur:false,mode:"local"};var b=new Ext.form.ComboBox(Ext.apply(c,{store:n,index:l,listeners:{select:{fn:function(s,o,q){var r=s.index;var t=o.get(s.valueField);this.onFilterSelect(r,t)},scope:this}}}));this.addText("    "+d+"  ");this.addField(b);this.cbFilters[l]=b}else{if(a==="IN"){this.filterStores=this.filterStores||{};var m=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var g=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"Data",dataIndex:"value",width:75},m]);var e={width:130,name:l,emptyText:"...",allowBlank:true,cm:g,sm:m};var n=new Ext.ux.data.PagingJsonStore({fields:["name","value","description"],data:[],lastOptions:{params:{start:0,limit:20}}});this.filterStores[l]=n;var h=new Sbi.console.LookupField(Ext.apply(e,{store:n,params:{},singleSelect:false,displayField:"value",valueField:"value",listeners:{select:{fn:function(o){var s=new Array();var q=l;for(var r in o){if(r!=="..."){s.push(r)}else{s=new Array()}}this.onFilterSelect(q,s)},scope:this}}}));this.addText("    "+d+"  ");this.addField(h)}else{Sbi.Msg.showWarning("Filter operator type ["+a+"] not supported")}}},reloadFilterStores:function(){for(var a in this.filterStores){this.reloadFilterStore(a)}this.store.filterPlugin.applyFilters()},reloadFilterStore:function(g){var a;var e;var n=this.filterStores[g];if(!n){Sbi.msg.showError("Impossible to refresh filter associated to column ["+g+"]");return}this.store.clearFilter(true);a=this.store.collect(g,true,true);e=[];var d={name:"...",value:"...",description:""};e.push(d);for(var h=0,c=a.length;h<c;h++){var m={name:a[h],value:a[h],description:a[h]};e.push(m)}n.loadData(e,false);if(this.cbFilters!==null&&this.cbFilters!==undefined){var b=this.cbFilters[g];if(b){b.collapse()}}},onFilterSelect:function(b,c){if(this.fireEvent("beforefilterselect",this,b,c)!==false){if(c==="..."||c.length==0){this.store.filterPlugin.removeFilter(b)}else{if(!Ext.isArray(c)){var a=new Array();a.push(c);c=a}this.store.filterPlugin.addFilter(b,c)}this.store.filterPlugin.applyFilters()}},onToggleIcons:function(e,o){var g=this.ownerCt;var u=g.store;var t=false;if(g.selectedRowsId==null){g.selectedRowsId=[]}if(e.actionConf.type=="selectRow"||e.actionConf.type=="unselectRow"||e.actionConf.type=="invertSelectionRow"){for(var h=0;h<u.getCount();h++){var n=u.getAt(h);var r=n.get(u.getFieldNameByAlias(e.actionConf.columnID));var m=n.get(u.getFieldNameByAlias(e.actionConf.flagColumn));var a=this.getPositionEl(r,g.selectedRowsId);if(e.actionConf.type=="selectRow"&&(m==1||m=="true")){if(a==-1){t=true;g.selectedRowsId.push(r)}}else{if(e.actionConf.type=="unselectRow"){if(a!=-1){t=true;delete g.selectedRowsId[a]}}else{if(e.actionConf.type=="invertSelectionRow"&&(m==1||m=="true")){t=true;if(a==-1){g.selectedRowsId.push(r)}else{delete g.selectedRowsId[a]}}}}if(t){g.isDirty=t;var b=(m===1||m==="1")?"true":"1";n.set(u.getFieldNameByAlias(e.actionConf.flagColumn),b);t=false}}return}for(var h=0,d=this.buttons.length;h<d;h++){var q=false;var c=this.buttons[h];if(c.actionConf.type==e.actionConf.type&&c.actionConf.name!==e.actionConf.name){c.setCheckValue(c.actionConf.checkColumn,o,false)}}},getPositionEl:function(c,a){var d=-1;if(a==null){return d}for(var b=0;b<a.length;b++){if(a[b]==c){d=b;break}}return d}});Ext.ns("Sbi.console");Sbi.console.CustomFilteringToolbar=function(a){var b={showIfEmpty:true,tbInizialzed:false};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.customFilteringToolbar){b=Ext.apply(b,Sbi.settings.console.customFilteringToolbar)}var d=Ext.apply(b,a||{});Ext.apply(this,d);if(this.showIfEmpty===true){d=Ext.apply(d,{items:[{xtype:"tbtext",text:this.emptyMsg}]})}Sbi.console.CustomFilteringToolbar.superclass.constructor.call(this,d);if(this.store!==undefined){this.store.on("metachange",this.onMetaChange,this)}};Ext.extend(Sbi.console.CustomFilteringToolbar,Sbi.console.FilteringToolbar,{services:null,tbInizialzed:null,AUTOMATIC_FILTERBAR:"automatic",CUSTOM_FILTERBAR:"custom",onRender:function(b,a){Sbi.console.CustomFilteringToolbar.superclass.onRender.call(this,b,a)},onMetaChange:function(a,c){var b;if(this.tbInizialzed===false){if(this.filterBar.type===this.AUTOMATIC_FILTERBAR){for(b=0;b<c.fields.length;b++){if(c.fields[b].header&&c.fields[b].header!==""){this.createFilterField(this.filterBar.defaults.operator,c.fields[b].header,a.getFieldNameByAlias(c.fields[b].header))}}this.store.on("load",this.reloadFilterStores,this)}else{if(this.filterBar.type===this.CUSTOM_FILTERBAR){for(b=0;b<c.fields.length;b++){if(c.fields[b].header&&c.fields[b].header!==""&&this.isConfiguratedFilter(c.fields[b].header)){this.createFilterField(this.getFilterOperator(c.fields[b].header),this.getColumnText(c.fields[b].header),a.getFieldNameByAlias(c.fields[b].header))}}this.store.on("load",this.reloadFilterStores,this)}else{Sbi.Msg.showError("Toolbar type ["+this.filterBar.type+"] is not supported")}}this.addActionButtons();this.doLayout();this.tbInizialzed=true}},isConfiguratedFilter:function(c){if(this.filterBar.filters){for(var b=0,a=this.filterBar.filters.length;b<a;b++){if(c===this.filterBar.filters[b].column){return true}}}return false},getColumnText:function(b){if(this.filterBar.filters){for(var c=0,a=this.filterBar.filters.length;c<a;c++){if(b===this.filterBar.filters[c].column){return this.filterBar.filters[c].text}}}return b},getFilterOperator:function(b){for(var c=0,a=this.filterBar.filters.length;c<a;c++){if(b===this.filterBar.filters[c].column){return this.filterBar.filters[c].operator}}return null}});Ext.ns("Sbi.console");Sbi.console.LookupField=function(a){Ext.apply(this,a);this.store=a.store;if(a.cm){this.cm=a.cm}if(a.sm){this.sm=a.sm}if(a.valueField){this.valueFieldName=a.valueField}if(a.descField&&a.descField!==""){this.displayFieldName=a.descField}else{this.displayFieldName=a.valueField||""}if(a.displayField&&a.displayField!==""){this.displayField=a.displayField||""}if(a.valueField&&a.valueField!==""){this.valueField=a.valueField||""}if(a.loadStore){this.loadStore=a.loadStore}this.store.on("metachange",function(c,d){this.updateMeta(d)},this);this.store.on("load",function(d,c,e){this.applySelection()},this);if(a.drawFilterToolbar!=null&&a.drawFilterToolbar!=undefined&&a.drawFilterToolbar==false){this.drawFilterToolbar=false}else{this.drawFilterToolbar=true}this.drawFilterToolbar=a.drawFilterToolbar;this.store.baseParams=a.params;this.params=a.params;this.initWin();var b=Ext.apply({},a,{triggerClass:"x-form-search-trigger",enableKeyEvents:true,width:150});Sbi.console.LookupField.superclass.constructor.call(this,b);this.on("render",function(c){c.trigger.on("click",function(d){this.onLookUp()},this)},this);this.on("render",function(c){c.el.on("keyup",function(d){this.xdirty=true},this)},this)};Ext.extend(Sbi.console.LookupField,Ext.form.TriggerField,{valueField:null,valueFieldName:null,displayField:null,displayFieldName:null,columnField:null,drawFilterToolbar:null,xvalue:null,xselection:{},xdirty:false,xTempValue:null,singleSelect:true,paging:true,start:0,limit:20,loadStore:null,store:null,sm:null,cm:null,grid:null,win:null,getValue:function(){this.clean();var a=[];this.xvalue=this.xvalue||{};for(p in this.xvalue){a.push(p)}if(this.singleSelect===true){a=(a.length>0)?a[0]:""}return a},setValue:function(a){if(typeof a==="object"){this.xvalue={};if(a instanceof Array){var c={};for(var b=0;b<a.length;b++){c[a[b]]=a[b]}a=c}Ext.apply(this.xvalue,a);var d="";for(p in this.xvalue){d+=this.xvalue[p]+";"}if(this.singleSelect===true){d=d.substr(0,d.length-1)}Sbi.console.LookupField.superclass.setValue.call(this,d)}else{this.xvalue={};this.xvalue[a]=a;Sbi.console.LookupField.superclass.setValue.call(this,a)}},initWin:function(){if(!this.cm){this.cm=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"Data",dataIndex:"data",width:75}])}var a=new Ext.PagingToolbar({pageSize:this.limit,store:this.store,displayInfo:true,displayMsg:"",emptyMsg:"No topics to display",items:["->",{text:LN("sbi.console.promptables.lookup.Annulla"),listeners:{click:{fn:this.onCancel,scope:this}}},{text:LN("sbi.console.promptables.lookup.Confirm"),listeners:{click:{fn:this.onOk,scope:this}}}]});if(this.drawFilterToolbar){this.filteringToolbar=new Sbi.console.FilteringToolbar({store:this.store})}if(!this.sm){this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect})}this.sm.on("rowselect",this.onSelect,this);this.sm.on("rowdeselect",this.onDeselect,this);if(this.drawFilterToolbar){this.gridLookup=new Ext.grid.GridPanel({store:this.store,cm:this.cm,sm:this.sm,frame:false,border:false,collapsible:false,loadMask:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true},tbar:this.filteringToolbar,bbar:a})}else{this.gridLookup=new Ext.grid.GridPanel({store:this.store,cm:this.cm,sm:this.sm,frame:false,border:false,collapsible:false,loadMask:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true},bbar:a})}this.win=new Ext.Window({title:LN("sbi.console.promptables.lookup.Select"),layout:"fit",width:580,height:300,closeAction:"hide",plain:true,items:[this.gridLookup]})},updateMeta:function(a){if(this.gridLookup){a.fields[0]=new Ext.grid.RowNumberer();a.fields[a.fields.length]=this.sm;this.gridLookup.getColumnModel().setConfig(a.fields);for(i=0;i<a.fields.length;i++){if(a.fields[i].header==this.valueFieldName){this.valueField=a.fields[i].name;break}}for(i=0;i<a.fields.length;i++){if(a.fields[i].header==this.displayFieldName){this.displayField=a.fields[i].name;break}}}else{alert("ERROR: store meta changed before grid instatiation")}},resetSelection:function(){this.xselection=Ext.apply({},this.xvalue)},onSelect:function(c,b,a){if(this.singleSelect===true){this.xselection={}}this.xselection[a.data[this.valueField]]=a.data[this.displayField]},onDeselect:function(c,b,a){if(this.xselection[a.data[this.displayField]]){delete this.xselection[a.data[this.displayField]]}else{if(this.xselection[a.data[this.valueField]]){delete this.xselection[a.data[this.valueField]]}}},applySelection:function(){if(this.gridLookup){var a=[];this.gridLookup.getStore().each(function(b){if(this.xselection[b.data[this.valueField]]!==undefined){a.push(b)}},this);if(a.length>0){this.sm.selectRecords(a)}}},clean:function(){if(this.xdirty){var d=Sbi.console.LookupField.superclass.getValue.call(this);var a=d.split(";");this.xvalue={};if(d.trim()===""){return}var b=(this.singleSelect===true)?1:a.length;for(var c=0;c<b;c++){this.xvalue[""+a[c]]=a[c]}this.xdirty=false}},onLookUp:function(){this.resetSelection();this.clean();this.win.show(this);var a=Ext.apply({},{start:this.start,limit:this.limit});this.store.load({params:a})},onOk:function(){this.setValue(this.xselection);this.fireEvent("select",this.xselection);this.win.hide()},onCancel:function(){this.resetSelection();this.win.hide()}});Ext.ns("Sbi.console");Sbi.console.PromptablesWindow=function(a){var b=Ext.apply({},a||{},{title:"Parameters window",width:500,height:300,hasBuddy:false,modal:true});if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.promptablesWindow){b=Ext.apply(b,Sbi.settings.console.promptablesWindow)}var d=Ext.apply(b,a||{});Ext.apply(this,d);this.initFormPanel();this.closeButton=new Ext.Button({text:LN("sbi.console.promptables.btnClose"),handler:function(){this.destroy()},scope:this});this.okButton=new Ext.Button({text:LN("sbi.console.promptables.btnOK"),handler:function(){this.fireEvent("click",this,this.getFormState());this.close()},scope:this});d=Ext.apply(d,{layout:"fit",closeAction:"close",constrain:true,plain:true,modal:true,title:this.title,buttonAlign:"center",buttons:[this.closeButton,this.okButton],items:[this.formPanel]});Sbi.console.PromptablesWindow.superclass.constructor.call(this,d);this.addEvents("click")};Ext.extend(Sbi.console.PromptablesWindow,Ext.Window,{serviceName:null,formPanel:null,fieldMap:null,okButton:null,closeButton:null,dateFormat:null,initFormPanel:function(){var a=[];this.fieldMap={};for(var e=0,b=this.promptables.length;e<b;e++){var m=null;var c=null;var h=this.promptables[e];var g=null;var d=null;for(p in h){if(p!=="values"&&p!=="scope"&&p!=="defaultValue"){m=h[p];c=p}}g=h;d=this.createParameterField(m,c,g);a.push(d);this.fieldMap[c]=d}this.formPanel=new Ext.FormPanel({margins:"50 50 50 50",labelAlign:"left",bodyStyle:"padding:5px",autoScroll:true,width:850,height:600,labelWidth:150,layout:"form",trackResetOnLoad:true,items:a})},getFormState:function(){var d={};var c=null;for(f in this.fieldMap){c=f;if(f.indexOf("__")>=0){c=f.substr(0,f.indexOf("__"))}if(this.fieldMap[f].isVisible()&&d[c]===undefined||d[c]===null){var b=this.fieldMap[f];var e=b.getValue();var a=b.defaultValue;if(a===undefined||a===null){a=(e!==null)?e.defaultValue:""}if((e===undefined||e===null||e=="")&&a!==undefined){d[c]=a.trim()}else{if(b.getXTypes().indexOf("/datefield")>=0){d[c]=Sbi.console.commons.Format.date(e,this.dateFormat)}else{d[c]=e}}}}return d},createStore:function(b){var a;var d={};if(b.datasetLabel){d.ds_label=b.datasetLabel;var c;c={serviceName:"GET_CONSOLE_DATA_ACTION"};c.baseParams=d;a=new Ext.data.JsonStore({url:Sbi.config.serviceRegistry.getServiceUrl(c)})}else{if(b.data){a=new Ext.data.SimpleStore({fields:["column_1","column_2"],data:b.data})}else{Sbi.Msg.showError("Store not defined for the prompt.","Service Error")}}a.on("exception",Sbi.exception.ExceptionHandler.onStoreLoadException,this);return a},createTextField:function(b,a,d){var c=new Ext.form.TextField({fieldLabel:b,name:a,width:250,defaultValue:d.defaultValue});return c},createDataField:function(b,a,d){this.dateFormat=d.values.format||"d/m/Y";var c=new Ext.form.DateField({fieldLabel:b||d.title,name:a,width:250,format:d.values.format||"d/m/Y",defaultValue:d.defaultValue});return c},createComboField:function(c,b,h){var g=null;var d="column_1";var a="column_2";g=this.createStore(h.values);if(h.values.datasetLabel){g.load()}var e=new Ext.form.ComboBox({fieldLabel:c||h.title,name:b,width:250,store:g,valueField:d,displayField:a,mode:"local",typeAhead:true,emptyText:"Select ...",selectOnFocus:true,triggerAction:"all",defaultValue:h.defaultValue});return e},createCheckListField:function(c,b,l){var e=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var a=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"Data",dataIndex:"value",width:75},e]);var h=null;h=this.createStore(l.values);h.on("beforeload",function(m,q){var n=Sbi.commons.JSON.encode(this.getFormState());q.params.PARAMETERS=n;return true},this);var d={fieldLabel:c||l.title,name:b,width:250,sm:e,cm:a,allowBlank:!p.mandatory,valueField:(l.values.valueField)?l.values.valueField:"code",descField:(l.values.descField)?l.values.descField:"",defaultValue:l.defaultValue};var g=new Sbi.console.LookupField(Ext.apply(d,{store:h,params:{},singleSelect:false}));return g},createListField:function(b,a,g){var e=null;e=this.createStore(g.values);e.on("beforeload",function(h,m){var l=Sbi.commons.JSON.encode(this.getFormState());m.params.PARAMETERS=l;return true},this);var c={fieldLabel:b||g.title,name:a,width:250,allowBlank:!p.mandatory,valueField:(g.values.valueField)?g.values.valueField:"code",descField:(g.values.descField)?g.values.descField:"",defaultValue:g.defaultValue};var d=new Sbi.console.LookupField(Ext.apply(c,{store:e,params:{},singleSelect:true}));return d},createRadioGroupField:function(n,a,c){var o=[];var g=null;var b=null;for(var h=0,d=c.values.options.length;h<d;h++){g=c.values.options[h];var l=a+"__"+h;b={id:l,name:a,labelSeparator:"",boxLabel:g.values.title||"",inputValue:l};o.push(b);if(g.defaultValue===undefined||g.defaultValue===null){g.defaultValue=c.defaultValue}var m=this.createParameterField(n,l,g);m.setVisible(false);o.push(m);this.fieldMap[l]=m;var e=new Ext.form.RadioGroup({id:a,name:a,fieldLabel:n,width:250,autoHeight:true,autoScroll:true,xtype:"fieldset",border:false,defaultType:"radio",columns:2,items:o,defaultValue:c.defaultValue});e.addListener("change",this.changeRadioField,this)}return e},createParameterField:function(c,b,d){var a=null;if(d.values===undefined||d.values.type=="text"){a=this.createTextField(c,b,d)}else{if(d.values.type=="data"){a=this.createDataField(c,b,d)}else{if(d.values.type=="combo"){a=this.createComboField(c,b,d)}else{if(d.values.type=="checkList"){a=this.createCheckListField(c,b,d)}else{if(d.values.type=="lookup"){a=this.createListField(c,b,d)}else{if(d.values.type=="group"){a=this.createRadioGroupField(c,b,d)}}}}}}if(d.values!==undefined&&d.values.defaultValue!==undefined){a.defaultValue=d.values.defaultValue}return a},changeRadioField:function(d,c){var a=c.getItemId().substr(0,c.getItemId().indexOf("__"));for(f in this.fieldMap){var b=this.fieldMap[f];var e=b.name||b.id;if(e==c.getItemId()){b.setVisible(true)}else{if(e.substr(0,e.indexOf("__"))===a){b.setVisible(false)}}}}});Ext.ns("Sbi.console");Sbi.console.GridPanel=function(a){var d={layout:"fit",loadMask:false,viewConfig:{forceFit:false,autoFill:true,enableRowBody:true,showPreview:true},start:0,limit:5};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.gridPanel){d=Ext.apply(d,Sbi.settings.console.gridPanel)}var g=Ext.apply(d,a||{});g.storeId=g.dataset;g.storeLabelsId=g.datasetLabels;delete g.dataset;var b=g.table||{};var e=g.filterBar||{};e.executionContext=g.executionContext;e.exportName=g.exportName;Ext.apply(this,g);this.initServices();this.initStore();this.initColumnModel();this.initSelectionModel();this.initFilterBar(e);this.initPagingBar();Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),{maxWidth:200,minWidth:100,showDelay:50,dismissDelay:0,closable:true,trackMouse:true});if(this.store!==undefined){this.store.pagingParams={start:this.start,limit:this.limit,paginator:this.pagingBar};this.pagingBar.refresh.hide();this.pagingBar.on("change",function(){this.store.pagingParams.start=this.pagingBar.cursor},this);this.filterBar.on("beforefilterselect",function(){this.pagingBar.moveFirst()},this);if(this.store.filterPlugin){this.store.filterPlugin.on("filterschange",function(c,h){this.pagingBar.onLoad(this.store,[],{params:this.store.pagingParams||{}})},this)}}var g=Ext.apply(g,{store:this.store,cm:this.columnModel,sm:this.selectionModel,tbar:this.filterBar,bbar:this.pagingBar});Sbi.console.GridPanel.superclass.constructor.call(this,g);this.addEvents("lock");this.addEvents("unlock")};Ext.extend(Sbi.console.GridPanel,Ext.grid.GridPanel,{services:null,store:null,storeLabels:null,columnModelLabels:null,columnModel:null,selectionModel:null,tempColumnModel:null,headersToHide:null,fieldsMap:null,selectedRowsId:null,hideSelectedRow:null,waitWin:null,errorWin:null,alarmWin:null,logsWin:null,promptWin:null,errorDs:"Errors",alarmDs:"Alarms",loadMask:null,filterBar:null,inlineCharts:null,inlineActions:null,AUTOMATIC_FILTERBAR:"automatic",CUSTOM_FILTERBAR:"custom",ACTIVE_VALUE:1,INACTIVE_VALUE:0,USER_ID:"userId",GRID_ACTIONS:{start:{serviceName:"START_WORK",images:{active:"../img/ico_start.gif",inactive:"../img/ico_start_gray.gif"}},stop:{serviceName:"STOP_WORK",images:{active:"../img/ico_stop.gif",inactive:"../img/ico_stop_gray.gif"}},informationlog:{serviceName:"DOWNLOAD_ZIP",images:"../img/ico_download_logs.gif"},crossnav:{serviceName:"CROSS_ACTION",images:{cross_detail:"../img/ico_cross_detail.gif",popup_detail:"../img/ico_popup_detail.gif"}},monitor:{serviceName:"UPDATE_ACTION",images:{inactive:"../img/ico_monitor.gif",active:"../img/ico_monitor_gray.gif"}},errors:{serviceName:"UPDATE_ACTION",images:{active:"../img/ico_errors.gif",inactive:"../img/ico_errors_gray.gif"}},alarms:{serviceName:"UPDATE_ACTION",images:{active:"../img/ico_alarms.gif",inactive:"../img/ico_alarms_gray.gif"}},views:{serviceName:"UPDATE_ACTION",images:{active:"../img/ico_views.gif",inactive:"../img/ico_views_gray.gif"}},refresh:{serviceName:"REFRESH_ACTION",images:"../img/ico_refresh.gif"},genericUpdate:{serviceName:"UPDATE_ACTION"},notifyStartAction:{serviceName:"NOTIFY_START_ACTION"}},resolveParameters:function(s,h,b,r){if(s==undefined){return}var g={};var m;var q=s.staticParams||"";g=Ext.apply(g,q);var a=s.dynamicParams||"";if(a){var t="";for(var e=0,d=a.length;e<d;e++){var c=a[e];if(c.scope==="dataset"){for(p in c){if(p==="scope"){continue}if(h.get(this.store.getFieldNameByAlias(c[p]))===undefined){t+='Parameter "'+c[p]+'" undefined into dataset.<p>'}else{g[p]=h.get(this.store.getFieldNameByAlias(c[p]))}}}else{if(c.scope==="env"){for(p in c){if(p==="scope"){continue}var n=c[p];if(p!==this.USER_ID&&b[n]===undefined){t+='Parameter "'+n+'" undefined into request. <p>'}else{g[p]=b[n]}}}else{if(c.scope==="promptable"){m=m||[];m.push(c)}}}}var o=s.metaParams;if(o){g.metaParams=Ext.util.JSON.encode(o)}}if(t!=""){Sbi.Msg.showError(t,"Service Error")}if(m!==undefined){this.promptWin=new Sbi.console.PromptablesWindow({promptables:m});this.promptWin.on("click",function(u,l){Ext.apply(g,l);r.call(this,g)},this);this.promptWin.show();this.promptWin.on("close",function(){this.fireEvent("unlock",this)},this)}else{r.call(this,g)}},execCrossNav:function(b,a,d,c){this.showMask();var e={label:c.document.label,windowName:this.name||parent.name,target:(c.target==="new")?"self":"popup",typeCross:"EXTERNAL"};if(e.target==="popup"){e.width=c.width||500;e.height=c.height||300}var g=function(o){var n="";e.parameters="";for(p in o){var l=o[p];if(Ext.isArray(l)){for(var m=0;m<l.length;m++){e.parameters+=n+p+"="+((l[m]==="%")?"%25":l[m])}}else{e.parameters+=n+p+"="+((o[p]==="%")?"%25":o[p])}n="&"}if(this.executionContext.EXECUTION_CONTEXT!==undefined&&this.executionContext.EXECUTION_CONTEXT==="DOCUMENT_COMPOSITION"){if(o.typeCross!==undefined&&o.typeCross=="INTERNAL"){var h="iframe_"+this.executionContext.DOCUMENT_LABEL;parent.execCrossNavigation(h,e.label,e.parameters)}else{parent.sendMessage(e,"crossnavigation")}}else{sendMessage(e,"crossnavigation")}this.hideMask.defer(2000,this)};this.resolveParameters(c.document,a,this.executionContext,g)},execAction:function(c,a,g,n){var e=this.getFieldsToToggle(c);for(var d=0,b=e.length;d<b;d++){var h=e[d];if(h.toggle){h.toggle(a)}}var m=function(l){l=Ext.apply(l,{message:c.type,userId:Sbi.user.userId});Ext.Ajax.request({url:this.services[c.type],params:l,success:function(o,q){if(o!==undefined&&o.responseText!==undefined){var r=Ext.util.JSON.decode(o.responseText);if(r!==undefined){}}else{Sbi.Msg.showError("Server response is empty","Service Error")}},failure:Sbi.exception.ExceptionHandler.onServiceRequestFailure,scope:this})};this.resolveParameters(n,a,this.executionContext,m)},toggleMonitor:function(d,c,b,a){this.store.filterPlugin.applyFilters();this.execAction(d,c,b,a)},showErrors:function(d,c,b,a){if(this.errorWin===null){this.errorWin=new Sbi.console.MasterDetailWindow({serviceName:"GET_ERROR_LIST_ACTION",action:d});this.errorWin.on("show",function(){this.fireEvent("lock",this)},this);this.errorWin.on("checked",function(h,g){this.errorWin.action.toggle(g);this.execAction(this.errorWin.action,g,null,a);if(this.errorWin.action.isChecked(g)){this.errorWin.checkButton.setText(LN("sbi.console.error.btnSetNotChecked"))}else{this.errorWin.checkButton.setText(LN("sbi.console.error.btnSetChecked"))}},this);this.errorWin.on("hide",function(){this.fireEvent("unlock",this)},this)}var e=function(g){g.ds_label=this.store.getDsLabel()+this.errorDs;this.errorWin.reloadMasterList(g);this.errorWin.setTarget(c);var h=d.isChecked(c);if(h){this.errorWin.checkButton.setText(LN("sbi.console.error.btnSetNotChecked"))}else{if(!h){this.errorWin.checkButton.setText(LN("sbi.console.error.btnSetChecked"))}}this.errorWin.show()};this.resolveParameters(a,c,this.executionContext,e)},showAlarms:function(d,c,b,a){if(this.alarmWin===null){this.alarmWin=new Sbi.console.MasterDetailWindow({serviceName:"GET_WARNING_LIST_ACTION",action:d});this.alarmWin.on("show",function(){this.fireEvent("lock",this)},this);this.alarmWin.on("checked",function(h,g){this.alarmWin.action.toggle(g);this.execAction(d,g,null,a);if(this.alarmWin.action.isChecked(g)){this.alarmWin.checkButton.setText(LN("sbi.console.error.btnSetNotChecked"))}else{this.alarmWin.checkButton.setText(LN("sbi.console.error.btnSetChecked"))}},this);this.alarmWin.on("hide",function(){this.fireEvent("unlock",this)},this)}var e=function(g){g.ds_label=this.store.getDsLabel()+this.alarmDs;this.alarmWin.reloadMasterList(g);this.alarmWin.setTarget(c);if(d.isChecked(c)){this.alarmWin.checkButton.setText(LN("sbi.console.error.btnSetNotChecked"))}else{this.alarmWin.checkButton.setText(LN("sbi.console.error.btnSetChecked"))}this.alarmWin.show()};this.resolveParameters(a,c,this.executionContext,e)},startProcess:function(d,c,b,a){this.fireEvent("lock",this);if(d.isChecked(c)){Sbi.Msg.showWarning("Process is already running");return}var e=function(m){for(p in m){var h=m[p];if(Ext.isArray(h)){var l="";for(var g=0;g<h.length;g++){l+=h[g]+","}l=l.substr(0,l.length-1);m[p]=l}}m=Ext.apply(m,{userId:Sbi.user.userId,DOCUMENT_LABEL:a.document.label});if(this.waitWin===null){this.waitWin=new Sbi.console.WaitWindow({})}this.waitWin.startingTxt="Starting process";this.waitWin.start();this.waitWin.show();Ext.Ajax.request({url:this.services[d.type],params:m,success:function(n,o){if(!n||!n.responseText){Sbi.Msg.showError("Server response is empty","Service Error");return}var q=Ext.util.JSON.decode(n.responseText);d.setBoundColumnValue(c,q.pid);if(m.stmt){m.pid=q.pid;Ext.Ajax.request({url:this.services.notifyStartAction,params:m,success:function(r,s){if(r!==undefined&&r.responseText!==undefined){var t=Ext.util.JSON.decode(r.responseText);if(t!==undefined){}}else{Sbi.Msg.showError("Server response is empty","Service Error")}},failure:Sbi.exception.ExceptionHandler.onServiceRequestFailure,scope:this})}this.waitWin.stop("Process started succesfully");d.toggle(c)},failure:function(n,o){Sbi.exception.ExceptionHandler.onServiceRequestFailure(n,o);this.waitWin.stop("Impossible to start process")},scope:this})};this.resolveParameters(a.document,c,this.executionContext,e)},stopProcess:function(d,c,b,a){if(d.isChecked(c)){Sbi.Msg.showWarning("Process is already stopped");return}var e=function(g){g=Ext.apply(g,{userId:Sbi.user.userId,DOCUMENT_LABEL:a.document.label});if(this.waitWin===null){this.waitWin=new Sbi.console.WaitWindow({})}this.waitWin.startingTxt="Stopping process";this.waitWin.start();this.waitWin.show();Ext.Ajax.request({url:this.services[d.type],params:g,success:function(h,l){if(!h||!h.responseText){Sbi.Msg.showError("Server response is empty","Service Error");return}var m=Ext.util.JSON.decode(h.responseText);d.setBoundColumnValue(c,m.pid);this.waitWin.stop("Proecess stopped succesfully");d.toggle(c);if(g.stmt){Ext.Ajax.request({url:this.services.genericUpdate,params:g,success:function(n,o){if(n!==undefined&&n.responseText!==undefined){var q=Ext.util.JSON.decode(n.responseText);if(q!==undefined){}}else{Sbi.Msg.showError("Server response is empty","Service Error")}},failure:Sbi.exception.ExceptionHandler.onServiceRequestFailure,scope:this})}},failure:function(h,l){Sbi.exception.ExceptionHandler.onServiceRequestFailure(h,l);this.waitWin.stop("Impossible to stop process")},scope:this})};this.resolveParameters(a.document,c,this.executionContext,e)},downloadLogs:function(d,c,b,a){var e=function(h){var g=Sbi.config.spagobiServiceRegistry.getServiceUrl({serviceName:"DOWNLOAD_ZIP",baseParams:new Object()});h=Ext.apply(h,{USER_ID:Sbi.user.userId,URL:g});this.logsWin=new Sbi.console.DownloadLogsWindow({serviceName:"DOWNLOAD_ZIP",action:d,options:a});this.logsWin.on("checked",function(m,l){this.logsWin.downloadLogs(d,l,null,h);this.logsWin=null},this);this.logsWin.show()};this.resolveParameters(a,c,this.executionContext,e)},updateSelectedRows:function(a){if(this.selectedRowsId==null){this.selectedRowsId=[]}this.selectedRowsId=a},stopLoading:function(){this.storeManager.stopRefresh(true,this.storeId)},restartLoading:function(){this.storeManager.stopRefresh(false,this.storeId)},initServices:function(){this.services=this.services||new Array();this.images=this.images||new Array();for(var b in this.GRID_ACTIONS){var a=this.GRID_ACTIONS[b];if(b==="start"){this.services[b]=this.services[b]||Sbi.config.commonjServiceRegistry.getServiceUrl({serviceName:a.serviceName,baseParams:new Object()})}else{if(b==="stop"){this.services[b]=this.services[b]||Sbi.config.commonjServiceRegistry.getServiceUrl({serviceName:a.serviceName,baseParams:new Object()})}else{if(b==="informationlog"){this.services[b]=this.services[b]||Sbi.config.spagobiServiceRegistry.getServiceUrl({serviceName:a.serviceName,baseParams:new Object()})}else{this.services[b]=this.services[b]||Sbi.config.serviceRegistry.getServiceUrl({serviceName:a.serviceName,baseParams:new Object()})}}}}},initStore:function(){this.store=this.storeManager.getStore(this.storeId);if(this.store===undefined){Sbi.Msg.showError("Dataset with identifier ["+this.storeId+"] is not correctly configurated")}else{this.store.remoteSort=false;this.store.on("exception",Sbi.exception.ExceptionHandler.onStoreLoadException,this);this.store.on("load",this.onLoad,this);this.store.on("metachange",this.onMetaChange,this)}},initColumnModel:function(){this.columnModel=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),{header:"Data",dataIndex:"data",width:150}]);this.columnModel.defaultSortable=true},initSelectionModel:function(){this.selectionModel=new Ext.grid.RowSelectionModel({singleSelect:false})},initFilterBar:function(a){if(a.type==="default"){Sbi.Msg.showError("Toolbar of type ["+a.type+"] is not yet supported")}else{if(a.type===this.CUSTOM_FILTERBAR||a.type===this.AUTOMATIC_FILTERBAR){this.filterBar=new Sbi.console.CustomFilteringToolbar({filterBar:a,store:this.store})}else{Sbi.Msg.showError("Toolbar of type ["+a.type+"] is not supported")}}},updateMetaStructure:function(b,d,e){for(var c=0,a=d.length;c<a;c++){if(b.fields[e[d[c]]]!==undefined){b.fields[e[d[c]]].hidden=true}}b.fields[0]=new Ext.grid.RowNumberer();this.getColumnModel().setConfig(b.fields);this.reconfigure(this.store,b)},initPagingBar:function(){this.pagingBar=new Ext.PagingToolbar({pageSize:this.limit,store:this.store,displayInfo:true})},onLoad:function(){var g=this.store.getCount();var u=this.getColumnModel();var q=u.config;var C=false;var m=[];var d={};u.fields=new Array(q.length);for(var v=0,w=q.length;v<w;v++){if(q[v].headerType!==undefined&&q[v].headerType.toUpperCase()==="DATASET"){var x=this.store.getAt(0);if(x!==undefined){var t=x.get(this.store.getFieldNameByAlias(q[v].header));if(t!==undefined){C=true;d[q[v].header]=(q[v].id+1);m.push(q[v].header);if(t===""){t="header__"+v;d[t]=(q[v].id);m.push(t)}else{q[v].header=t}u.fields[v]=Ext.apply({},q[v])}}else{u.fields[v]=Ext.apply({},q[v])}}else{if(q[v].headerType!==undefined&&q[v].headerType.toUpperCase()==="I18N"){var t=LN(q[v].header);if(t!==undefined){C=true;q[v].header=t;u.fields[v]=Ext.apply({},q[v])}else{u.fields[v]=Ext.apply({},q[v])}}else{u.fields[v]=Ext.apply({},q[v])}}}if(this.inlineCharts!==undefined&&this.inlineCharts!==null){var l=0;var z=0;var B=0;var e=0;var A=0;var r={};var c="";var y="";var o="";var b="";for(var n=0,w=this.inlineCharts.length;n<w;n++){l=0;z=0;B=0;if(this.inlineCharts[n]!==undefined){for(var v=0;v<g;v++){var x=this.store.getAt(v);var a=x.get(this.store.getFieldNameByAlias(this.inlineCharts[n].column));if((this.inlineCharts[n].type=="point"||this.inlineCharts[n].type=="semaphore")&&this.inlineCharts[n].thresholdType=="dataset"){if(this.inlineCharts[n].threshold!==undefined||this.inlineCharts[n].thresholdFirstInt!==undefined||this.inlineCharts[n].thresholdSecondInt!==undefined){r=Ext.apply({},this.inlineCharts[n]||{});r.tooltip=Sbi.locale.getLNValue(r.tooltip);r.tooltipGreen=Sbi.locale.getLNValue(r.tooltipGreen);r.tooltipYellow=Sbi.locale.getLNValue(r.tooltipYellow);r.tooltipRed=Sbi.locale.getLNValue(r.tooltipRed);C=true;A=this.getColumnModel().findColumnIndex(this.store.getFieldNameByAlias(this.inlineCharts[n].column));if(this.inlineCharts[n].threshold!==undefined){c=this.getNameFieldForThreshold(this.inlineCharts[n].threshold,d,m);r.nameFieldThr=c}if(this.inlineCharts[n].thresholdFirstInt!==undefined){y=this.getNameFieldForThreshold(this.inlineCharts[n].thresholdFirstInt,d,m);r.nameFieldThrFirstInt=y}if(this.inlineCharts[n].thresholdSecondInt!==undefined){o=this.getNameFieldForThreshold(this.inlineCharts[n].thresholdSecondInt,d,m);r.nameFieldThrSecondInt=o}r=this.getTooltipFromFields(r,d,m);var s=this.createInlineChartRenderer(r);if(s!==null){q[A].renderer=s;u.fields[A]=Ext.apply({},q[A])}}}else{if((this.inlineCharts[n].type=="point"||this.inlineCharts[n].type=="semaphore")&&this.inlineCharts[n].thresholdType=="env"){if(this.inlineCharts[n].threshold!==undefined||this.inlineCharts[n].thresholdFirstInt!==undefined||this.inlineCharts[n].thresholdSecondInt!==undefined){A=this.getColumnModel().findColumnIndex(this.store.getFieldNameByAlias(this.inlineCharts[n].column));r=Ext.apply({},this.inlineCharts[n]||{});r.tooltip=Sbi.locale.getLNValue(r.tooltip);r.tooltipGreen=Sbi.locale.getLNValue(r.tooltipGreen);r.tooltipYellow=Sbi.locale.getLNValue(r.tooltipYellow);r.tooltipRed=Sbi.locale.getLNValue(r.tooltipRed);C=true;r.threshold=this.executionContext[this.inlineCharts[n].threshold];r.thresholdFirstInt=this.executionContext[this.inlineCharts[n].thresholdFirstInt];r.thresholdSecondInt=this.executionContext[this.inlineCharts[n].thresholdSecondInt];r=this.getTooltipFromEnv(r);var s=this.createInlineChartRenderer(r);if(s!==null){q[A].renderer=s;u.fields[A]=Ext.apply({},q[A])}}}else{if(this.inlineCharts[n].type=="bar"){if(a!==undefined){B=B+a;if(a<l||v===0){l=a}if(a>z){z=a}}}}}}if(g>0&&this.inlineCharts[n].type=="bar"){this.inlineCharts[n].maxValue=z;this.inlineCharts[n].minValue=l;this.inlineCharts[n].totValue=B;var h=this.getColumnModel().findColumnIndex(this.store.getFieldNameByAlias(this.inlineCharts[n].column));this.getColumnModel().setRenderer(h,this.createInlineChartRenderer(this.inlineCharts[n]))}}}}if(this.storeLabelsId!==undefined){this.tempColumnModel=u;this.headersToHide=m;this.fieldsMap=d;this.loadStoreForHeaders()}else{if(C){this.updateMetaStructure(u,m,d)}}},onMetaChange:function(e,m){var y;var d={};var v=Ext.apply({},m);var q=v.fields;v.fields=new Array(q.length);for(y=0;y<q.length;y++){if((typeof q[y])==="string"){q[y]={name:q[y]}}if(this.columnId!==undefined&&this.columnId===q[y].header){q[y].hidden=true}v.fields[y]=Ext.apply({},q[y]);d[q[y].name]=y}var h={};if(this.inlineCharts){for(var x=0,z=this.inlineCharts.length;x<z;x++){h[this.inlineCharts[x].column]=this.inlineCharts[x]}}for(y=0;y<v.fields.length;y++){var n=Ext.apply({},this.columnConfig[v.fields[y].header]||{},this.columnDefaultConfig);v.fields[y]=Ext.apply(v.fields[y],n);if(v.fields[y].type){var g=v.fields[y].type;if(g=="date"||g=="timestamp"){v.fields[y].renderer=Sbi.locale.formatters[g]}else{v.fields[y].renderer=this.renderTooltip.createDelegate(this)}}if(v.fields[y].subtype&&v.fields[y].subtype==="html"){v.fields[y].renderer=Sbi.locale.formatters.html}v.fields[y].sortable=true;var o=null;if((o=h[v.fields[y].header])!==undefined){var s=this.createInlineChartRenderer(o);if(s!==null){v.fields[y].renderer=s}else{Sbi.Msg.showWarning("Impossible to create inlineChart on column ["+v.fields[y].header+"]")}}}if(this.inlineActions){for(var y=0,u=this.inlineActions.length;y<u;y++){if(this.inlineActions[y].type==undefined){this.inlineActions[y].type=this.inlineActions[y].name}var a=this.createInlineActionColumn(this.inlineActions[y]);if(a!==null){if(this.inlineActions[y].imgSrcInactive!==undefined){var c=this.inlineActions[y].imgSrcInactive.substr(0,this.inlineActions[y].imgSrcInactive.indexOf("."));if(Ext.util.CSS.getRule(".x-grid3-hd-"+c+"_header")==null){var w=".x-grid3-hd-"+c+"_header { background: url(../img/"+this.inlineActions[y].imgSrcInactive+") center center no-repeat; height:20px;}";Ext.util.CSS.createStyleSheet(w)}a.cls=c+"_header"}else{a.cls=this.inlineActions[y].type+"_header"}v.fields.push(a)}else{Sbi.Msg.showWarning("Impossible to create inlineActionColumn ["+this.inlineActions[y].type+"]")}var b;if(this.inlineActions[y].checkColumn){b=this.store.getFieldNameByAlias(this.inlineActions[y].checkColumn);if(b!==undefined){v.fields[d[b]].hidden=true}}if(this.inlineActions[y].flagColumn){b=this.store.getFieldNameByAlias(this.inlineActions[y].flagColumn);if(b!==undefined){v.fields[d[b]].hidden=true}}}}if(this.filterBar.actions){for(var y=0,u=this.filterBar.actions.length;y<u;y++){var r=this.filterBar.actions[y];if(r.flagColumn!==undefined){var b=this.store.getFieldNameByAlias(r.flagColumn);if(b!==undefined){v.fields[d[b]].hidden=true}}}}v.fields[0]=new Ext.grid.RowNumberer();this.getColumnModel().setConfig(v.fields)},createInlineChartRenderer:function(a){var b=null;if(a.type==="bar"){renderer=Sbi.console.commons.Format.inlineBarRenderer(a)}else{if(a.type==="point"){renderer=Sbi.console.commons.Format.inlinePointRenderer(a)}else{if(a.type==="semaphore"){renderer=Sbi.console.commons.Format.inlineSemaphoreRenderer(a)}else{Sbi.Msg.showWarning("InlineChart type ["+chartConf.type+"] is not supported")}}}return renderer},createInlineActionColumn:function(d){var c=null;var e=d;e=Ext.apply({grid:this,scope:this},e);e.tooltip=Sbi.locale.getLNValue(e.tooltip);e.tooltipInactive=Sbi.locale.getLNValue(e.tooltipInactive);e.tooltipActive=Sbi.locale.getLNValue(e.tooltipActive);if(e.type!=="selectRow"){if(e.imgSrcActive!==undefined){e.imgSrcActive="../img/"+e.imgSrcActive}else{if(this.GRID_ACTIONS[e.type].images.active!==undefined){e.imgSrcActive=this.GRID_ACTIONS[e.type].images.active}}if(e.imgSrcInactive!==undefined){e.imgSrcInactive="../img/"+e.imgSrcInactive}else{if(this.GRID_ACTIONS[e.type].images.inactive!==undefined){e.imgSrcInactive=this.GRID_ACTIONS[e.type].images.inactive}}}if(e.type==="crossnav"){if(e.imgSrc!==undefined){e.imgSrc="../img/"+e.imgSrc}else{e.imgSrc=this.GRID_ACTIONS[e.type].images.cross_detail;if(e.config){if(e.config.target==="self"){e.imgSrc=this.GRID_ACTIONS[e.type].images.popup_detail}}}e.handler=this.execCrossNav;c=new Sbi.console.InlineActionColumn(e)}else{if(e.type==="monitor"){e.handler=this.toggleMonitor;var b=this.store.getFieldNameByAlias(e.checkColumn);if(b!==undefined){if(this.store.filterPlugin.getFilter(b)===undefined){var a=new Array();a.push(this.ACTIVE_VALUE);this.store.filterPlugin.addFilter(b,a)}}c=new Sbi.console.InlineToggleActionColumn(e)}else{if(e.type==="errors"){e.toggleOnClick=false;e.handler=this.showErrors;c=new Sbi.console.InlineToggleActionColumn(e)}else{if(e.type==="alarms"){e.toggleOnClick=false;e.handler=this.showAlarms;c=new Sbi.console.InlineToggleActionColumn(e)}else{if(e.type==="views"){e.toggleOnClick=true;e.handler=this.execAction;c=new Sbi.console.InlineToggleActionColumn(e)}else{if(e.type==="start"){e.toggleOnClick=false;e.handler=this.startProcess;e.isChecked=function(g){var h,l;if(this.isBoundToColumn()){h=this.getBoundColumnValue(g);l=(h!=0)}return l};e.setChecked=function(h,g){var l,m;if(this.isBoundToColumn()){m=this.grid.store;if(g){h.set(m.getFieldNameByAlias(this.checkColumn),"34")}}};c=new Sbi.console.InlineToggleActionColumn(e)}else{if(e.type==="stop"){e.toggleOnClick=false;e.handler=this.stopProcess;e.isChecked=function(g){var h,l;if(this.isBoundToColumn()){h=this.getBoundColumnValue(g);l=(h==0)}return l};e.setChecked=function(h,g){var l,m;if(this.isBoundToColumn()){m=this.grid.store;if(g){h.set(m.getFieldNameByAlias(this.checkColumn),0)}}};c=new Sbi.console.InlineToggleActionColumn(e)}else{if(e.type==="informationlog"){e.imgSrc=this.GRID_ACTIONS[e.type].images;e.handler=this.downloadLogs;c=new Sbi.console.InlineActionColumn(e)}else{if(e.type==="selectRow"){e.handler=this.updateSelectedRows;c=new Sbi.console.InlineCheckColumn(e);c.masterCheckValue=null}else{e.imgSrc=this.GRID_ACTIONS[e.type].images;e.handler=this.execAction;c=new Sbi.console.InlineActionColumn(e)}}}}}}}}}return c},getFieldsToToggle:function(d){var e=[];for(var b=0,a=this.columnModel.fields.length;b<a;b++){var c=this.columnModel.fields[b];if(c.type==d.type&&c.name!==d.name){e.push(c)}}return e},getTooltipFromFields:function(c,d,a){var b;if((c.tooltip&&c.tooltip.indexOf("$F{")===-1)&&(c.tooltipGreen&&c.tooltipGreen.indexOf("$F{")===-1)&&(c.tooltipYellow&&c.tooltipYellow.indexOf("$F{")===-1)&&(c.tooltipRed&&c.tooltipRed.indexOf("$F{")===-1)){return c}if(c.tooltip!==undefined){c.nameTooltipField=this.getFieldsConfiguration(c.tooltip,d,a)}if(c.tooltipGreen!==undefined){c.nameTooltipFieldGreen=this.getFieldsConfiguration(c.tooltipGreen,d,a)}if(c.tooltipYellow!==undefined){c.nameTooltipFieldYellow=this.getFieldsConfiguration(c.tooltipYellow,d,a)}if(c.tooltipRed!==undefined){c.nameTooltipFieldRed=this.getFieldsConfiguration(c.tooltipRed,d,a)}return c},getFieldsConfiguration:function(c,m,e){var g;var h;var b;var a;var l;var d;l=new Array();while(c.indexOf("$F{")!==-1){d={};g=c.indexOf("$F{")+3;h=c.indexOf("}")-g;b=c.substr(g,h);a=this.getColumnModel().findColumnIndex(this.store.getFieldNameByAlias(b));m[b]=a;if(e.indexOf(b)<0){e.push(b)}d.name=b;d.value=this.store.getFieldNameByAlias(b);l.push(d);c=c.replace("$F{"+b+"}","")}return l},getTooltipFromEnv:function(b){var a;if((b.tooltip&&b.tooltip.indexOf("$P{")===-1)&&(b.tooltipGreen&&b.tooltipGreen.indexOf("$P{")===-1)&&(b.tooltipYellow&&b.tooltipYellow.indexOf("$P{")===-1)&&(b.tooltipRed&&b.tooltipRed.indexOf("$P{")===-1)){return b}if(b.tooltip!==undefined){b.tooltip=this.getVarConfiguration(b.tooltip)}if(b.tooltipGreen!==undefined){b.tooltipGreen=this.getVarConfiguration(b.tooltipGreen)}if(b.tooltipYellow!==undefined){b.tooltipYellow=this.getVarConfiguration(b.tooltipYellow)}if(b.tooltipRed!==undefined){b.tooltipRed=this.getVarConfiguration(b.tooltipRed)}return b},getVarConfiguration:function(g){var b;var c;var d;while(g.indexOf("$P{")!==-1){b=g.indexOf("$P{")+3;c=g.indexOf("}")-b;d=g.substr(b,c);if(d){var e=this.executionContext[d]||" ";if(e){var a=g.replace("$P{"+d+"}",e);g=a}}else{break}}return g},getNameFieldForThreshold:function(a,c,b){idxFieldThreshold=this.getColumnModel().findColumnIndex(this.store.getFieldNameByAlias(a));c[a]=idxFieldThreshold;if(b.indexOf(a)<0){b.push(a)}nameFieldThreshold=this.store.getFieldNameByAlias(a);return nameFieldThreshold},loadStoreForHeaders:function(){this.storeLabels=this.storeManager.getStore(this.storeLabelsId);if(this.storeLabels===undefined){Sbi.Msg.showError("Dataset with identifier ["+this.storeLabelsId+"] is not correctly configurated")}else{this.storeLabels.on("exception",Sbi.exception.ExceptionHandler.onStoreLoadException,this);this.storeLabels.on("metachange",this.onMetaChangeLabels,this);this.storeLabels.on("load",this.changeLabelsByDatatset,this);this.storeLabels.loadStore()}},onMetaChangeLabels:function(b,d){var e={};var c=Ext.apply({},d);var a=c.fields;c.fields=new Array(a.length);for(i=0;i<a.length;i++){if((typeof a[i])==="string"){a[i]={name:a[i]}}if(this.columnId!==undefined&&this.columnId===a[i].header){a[i].hidden=true}c.fields[i]=Ext.apply({},a[i]);e[a[i].name]=i}this.columnModelLabels=c.fields;if(this.storeLabels.alias2FieldMetaMap==null){this.storeLabels.alias2FieldMetaMap=this.columnModelLabels}},changeLabelsByDatatset:function(){var n=this.tempColumnModel;var e=n.config;var d=null;var m=null;var l=null;for(var c=0,g=e.length;c<g;c++){if(e[c]!==undefined&&e[c].headerType!==undefined&&e[c].headerType.toUpperCase()==="DATASETI18N"){if(this.storeLabels.alias2FieldMetaMap!==undefined&&this.storeLabels.alias2FieldMetaMap!==null){if(m==null||d==null||l==null){d=(this.storeLabels.getFieldMetaByAlias("LOCALE")!==undefined)?this.storeLabels.getFieldMetaByAlias("LOCALE"):this.storeLabels.getFieldMetaByAlias("locale");if(d!==undefined){d=d.dataIndex}l=(this.storeLabels.getFieldMetaByAlias("CODE")!==undefined)?this.storeLabels.getFieldMetaByAlias("CODE"):this.storeLabels.getFieldMetaByAlias("code");if(l!==undefined){l=l.dataIndex}m=(this.storeLabels.getFieldMetaByAlias("LABEL")!==undefined)?this.storeLabels.getFieldMetaByAlias("LABEL"):this.storeLabels.getFieldMetaByAlias("label");if(m!==undefined){m=m.dataIndex}}}if(d==undefined||l==undefined||m==undefined){Sbi.Msg.showError(LN("sbi.console.localization.columnsKO"),"Service Error");n.fields[c]=Ext.apply({},e[c])}else{var h=this.storeLabels.findBy(function(o){if(d!==undefined&&l!==undefined){if(o.data[d]===Sbi.user.locale&&o.data[l]===e[c].header){return true}}return false},this);var b=this.storeLabels.getAt(h);if(b!==undefined){var a=b.get(m);if(a!==undefined){metaIsChanged=true;e[c].header=a;n.fields[c]=Ext.apply({},e[c])}else{n.fields[c]=Ext.apply({},e[c])}}else{n.fields[c]=Ext.apply({},e[c])}}}else{n.fields[c]=Ext.apply({},e[c])}}this.updateMetaStructure(n,this.headersToHide,this.fieldsMap)},findByLocaleAndCode:function(e,a,d,c){for(var b=0;b<this.storeLabels.getCount();b++){var g=this.storeLabels.getAt(b);if(g.get(e)==a&&g.get(d)==c){alert("return: "+b);return b}}return -1},showMask:function(){this.un("afterlayout",this.showMask,this);if(this.loadMask==null){this.loadMask=new Ext.LoadMask("GridPanel",{msg:"Loading.."})}if(this.loadMask){this.loadMask.show()}},hideMask:function(){if(this.loadMask&&this.loadMask!=null){this.loadMask.hide()}},renderTooltip:function(d,a,b){var c=b.data;return'<div qtip="'+d+'">'+d+"</div>"}});Ext.ns("Sbi.console");Sbi.console.DetailPage=function(b){var e={title:LN("sbi.console.detailpage.title"),layout:"fit"};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.detailPage){e=Ext.apply(e,Sbi.settings.console.detailPage)}var g=Ext.apply(e,b||{});var a=g.navigationBar||{};a.executionContext=g.executionContext;delete g.navigationBar;var d=g.table||{};d.executionContext=g.executionContext;d.storeManager=g.storeManager;d.exportName=g.exportName;delete g.table;Ext.apply(this,g);this.initNavigationToolbar(a);this.initGridPanel(d);g=Ext.apply(g,{tbar:this.navigationToolbar,items:[this.gridPanel]});Sbi.console.DetailPage.superclass.constructor.call(this,g)};Ext.extend(Sbi.console.DetailPage,Ext.Panel,{services:null,navigationToolbar:null,gridPanel:null,getStore:function(){return this.gridPanel.store},getStoreLabels:function(){return this.gridPanel.storeLabels},initNavigationToolbar:function(a){this.navigationToolbar=new Sbi.console.NavigationToolbar(a)},initGridPanel:function(a){this.gridPanel=new Sbi.console.GridPanel(a)}});Ext.ns("Sbi.console");Sbi.console.DetailPanel=function(a){var b={layout:"fit",bodyStyle:"padding: 8px",region:"center"};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.detailPanel){b=Ext.apply(b,Sbi.settings.console.detailPanel)}var e=Ext.apply(b,a||{});var d=e.pages||[];d.executionContext=e.executionContext;d.storeManager=e.storeManager;delete e.pages;Ext.apply(this,e);this.initDetailPages(d);this.initTabPanel();e=Ext.apply(e,{items:[this.tabPanel]});Sbi.console.DetailPanel.superclass.constructor.call(this,e)};Ext.extend(Sbi.console.DetailPanel,Ext.Panel,{pages:null,activePage:null,tabPanel:null,getActivePage:function(){return this.activePage},initDetailPages:function(h){this.pages=new Array();var a=null;for(var d=0,b=h.length;d<b;d++){var c=h[d];c.executionContext=h.executionContext;c.storeManager=h.storeManager;var g=this.getTitlePage(c);c.title=g;a=new Sbi.console.DetailPage(c);this.pages.push(a);var e=c.storeManager.getStore(c.table.dataset);if(e!==undefined){if(d===0){e.stopped=false}else{e.stopped=true}}}},initTabPanel:function(){this.tabPanel=new Ext.TabPanel({activeTab:0,items:this.pages});this.tabPanel.on("tabchange",function(g,d){if(g!==undefined&&d!==undefined&&this.activePage!=undefined){for(var b=0,a=this.pages.length;b<a;b++){var e=this.pages[b];var c=e.getStore();if(e.getStore().getDsLabel()===this.activePage.getStore().getDsLabel()){c.stopped=true}else{if(e.getStore().getDsLabel()===d.getStore().getDsLabel()){c.stopped=false;c.load({params:{},callback:function(){this.ready=true},scope:c,add:false})}}}}this.activePage=d},this)},getTitlePage:function(a){var b=Sbi.locale.getLNValue(a.title);if(b.indexOf("$P{")!==-1){b=this.getVarConfiguration(b,a)}return b},getVarConfiguration:function(h,b){var a;var d;var e;while(h.indexOf("$P{")!==-1){a=h.indexOf("$P{")+3;d=h.indexOf("}")-a;e=h.substr(a,d);if(e){var c=b.executionContext[e]||" ";if(c=="%"){c=" "}if(c){var g=h.replace("$P{"+e+"}",c);h=g}}else{break}}return h}});Ext.ns("Sbi.console");Sbi.console.ConsolePanel=function(b){var l={title:LN("sbi.console.consolepanel.title"),layout:"border"};if(Sbi.settings&&Sbi.settings.console&&Sbi.settings.console.consolePanel){l=Ext.apply(l,Sbi.settings.console.consolePanel)}var o=Ext.apply(l,b||{});var d=o.datasets||[];delete o.datasets;var e=o.summaryPanel;if(e){e.executionContext=o.executionContext}delete o.summaryPanel;var n=o.detailPanel;if(n){n.executionContext=o.executionContext}delete o.detailPanel;Ext.apply(this,o);this.services=this.services||new Array();this.services["export"]=this.services["export"]||Sbi.config.serviceRegistry.getServiceUrl({serviceName:"EXPORT_ACTION",baseParams:new Object()});this.initStoreManager(d);var m=new Array();if(e!==undefined){e.storeManager=this.storeManager;this.initSummaryPanel(e);m.push(this.summaryPanel)}if(n!==undefined){n.storeManager=this.storeManager;this.initDetailPanel(n);m.push(this.detailPanel)}if(this.detailPanel===null){if(!this.summaryPanel===null){m.push({region:"center",html:"The console is empty. Please check the template."})}else{this.summaryPanel.region="center"}}o=Ext.apply(o,{items:m});Sbi.console.ConsolePanel.superclass.constructor.call(this,o);if(Ext.isIE){onhostmessage(this.exportConsole,this,false,"export");onhostmessage(this.onHide,this,false,"hide");onhostmessage(this.onShow,this,false,"show")}else{var h=this;var a=function(){h.setHostMessagges()};setTimeout(a,8000)}if(this.detailPanel){for(var g=0;g<this.detailPanel.pages.length;g++){this.detailPanel.pages[g].gridPanel.on("lock",this.onHide,this);this.detailPanel.pages[g].gridPanel.on("unlock",this.onShow,this)}}};Ext.extend(Sbi.console.ConsolePanel,Ext.Panel,{services:null,storeManager:null,summaryPanel:null,detailPanel:null,initStoreManager:function(a){this.storeManager=new Sbi.console.StoreManager({datasetsConfig:a})},initSummaryPanel:function(a){this.summaryPanel=new Sbi.console.SummaryPanel(a)},initDetailPanel:function(a){this.detailPanel=new Sbi.console.DetailPanel(a)},exportConsole:function(d){var b=this.detailPanel.getActivePage();var c=b.gridPanel.getColumnConfigs();var a=(b.getStoreLabels()!==undefined)?b.getStoreLabels().getDsLabel():"";var e={mimeType:"application/pdf",responseType:"attachment",datasetHeadersLabel:a,meta:Ext.util.JSON.encode(c)};Sbi.Sync.request({url:this.services["export"],params:e})},onHide:function(){this.storeManager.stopRefresh(true)},onShow:function(a){this.storeManager.stopRefresh(false)},setHostMessagges:function(){onhostmessage(this.exportConsole,this,false,"export");onhostmessage(this.onHide,this,false,"hide");onhostmessage(this.onShow,this,false,"show")},refreshData:function(){this.storeManager.forceRefresh()}});